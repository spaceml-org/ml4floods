

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Kherson Dam Break end-to-end floodmap &#8212; ML4Floods</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/ml4ops/HOWTO_postprocess_inference';</script>
    <link rel="shortcut icon" href="../../_static/ml4cc_logo.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Inference with clouds aware floods segmentation model" href="HOWTO_Run_Inference_multioutput_binary.html" />
    <link rel="prev" title="Introduction" href="../config.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../config.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/ml4cc_logo.png" class="logo__image only-light" alt="ML4Floods - Home"/>
    <script>document.write(`<img src="../../_static/ml4cc_logo.png" class="logo__image only-dark" alt="ML4Floods - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../config.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Inference with clouds-aware models</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Kherson Dam Break <em>end-to-end</em> floodmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="HOWTO_Run_Inference_multioutput_binary.html">Inference with clouds aware floods segmentation model</a></li>
<li class="toctree-l1"><a class="reference internal" href="HOWTO_inference_on_image_time_series.html">Run inference on time series of Sentinel-2 images</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">The *WorldFloods* dataset</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../worldfloods_dataset.html">The <em>WorldFloods</em> database</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data prep</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../prep/full_data_ingest.html">Ingest Flood Extent Maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prep/gt_masks_generation.html">Ground Truth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../labeling.html">Viewer and label editor</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">ML model development</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../ml_overview.html">MLOps overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="HOWTO_Train_models.html">Train models</a></li>
<li class="toctree-l1"><a class="reference internal" href="HOWTO_performance_metrics_workflow.html">Model Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="HOWTO_Run_Inference_on_new_data.html">Run inference</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Experimental</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../prep/demo_pytorch_transforms.html">Pre-processing Demonstration</a></li>
<li class="toctree-l1"><a class="reference internal" href="HOWTO_Calculate_uncertainty_maps.html">Probabilistic neural networks</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Project rationale</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../intro/introduction.html">Project rationale</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/spaceml-org/ml4floods/blob/main/jupyterbook/content/ml4ops/HOWTO_postprocess_inference.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/spaceml-org/ml4floods" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/content/ml4ops/HOWTO_postprocess_inference.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Kherson Dam Break end-to-end floodmap</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-install-and-import-the-necessary-packages">Step 1: Install and import the necessary packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-define-query-parameters-area-of-interest-and-dates">Step 2: Define query parameters: area of interest and dates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-read-the-data">Step 3: Read the data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-load-the-model">Step 3: Load the model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-run-inference">Step 4: Run inference</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-plot-the-results">Step 5: Plot the results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-vectorize-predictions-into-prepost-flood-products">Step 5: Vectorize predictions into prepost flood products</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#run-inference-in-landsat-8-9">Run inference in Landsat 8/9</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#join-the-floodmaps-of-sentinel-2-and-landsat">Join the floodmaps of Sentinel-2 and Landsat</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#licence">Licence</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="kherson-dam-break-end-to-end-floodmap">
<h1>Kherson Dam Break <em>end-to-end</em> floodmap<a class="headerlink" href="#kherson-dam-break-end-to-end-floodmap" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p><strong>Last Modified</strong>: 30-11-2023</p></li>
<li><p><strong>Authors</strong>: Gonzalo Mateo-García, Enrique Portalés-Julià</p></li>
</ul>
<hr class="docutils" />
<p>This notebook shows how to produce flood extent maps from Sentinel-2 and Landsat using the clouds aware flood sementation model proposed in:</p>
<blockquote>
<div><p>E. Portalés-Julià, G. Mateo-García, C. Purcell, and L. Gómez-Chova <a class="reference external" href="https://www.nature.com/articles/s41598-023-47595-7">Global flood extent segmentation in optical satellite images</a>. <em>Scientific Reports 13, 20316</em> (2023). DOI: 10.1038/s41598-023-47595-7.</p>
</div></blockquote>
<p>In particular, the notebook shows how to: query the available S2 and Landsat images, download them, run inference with the model and vectorize the model outputs to derive prepost event floodmaps. We focus in the region of Nova Kakhovka, Kherson, Ukraine, where recently a dam break caused several flooding.</p>
<p><strong>Note</strong>: If you run this notebook in Google Colab you may want to change the running environment to use a GPU.</p>
<section id="step-1-install-and-import-the-necessary-packages">
<h2>Step 1: Install and import the necessary packages<a class="headerlink" href="#step-1-install-and-import-the-necessary-packages" title="Permalink to this heading">#</a></h2>
<p>Install the <code class="docutils literal notranslate"><span class="pre">ml4floods</span></code> and <code class="docutils literal notranslate"><span class="pre">geemap</span></code> packages if not installed</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!pip install geemap
!pip install ml4floods
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ee</span>
<span class="c1"># ee.Authenticate()</span>
<span class="n">ee</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="nn">georeader.readers</span> <span class="kn">import</span> <span class="n">ee_query</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">shape</span> 
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">georeader.readers</span> <span class="kn">import</span> <span class="n">S2_SAFE_reader</span>
<span class="kn">from</span> <span class="nn">georeader.save</span> <span class="kn">import</span> <span class="n">save_cog</span>
<span class="kn">from</span> <span class="nn">georeader</span> <span class="kn">import</span> <span class="n">window_utils</span><span class="p">,</span> <span class="n">mosaic</span>
<span class="kn">from</span> <span class="nn">georeader.plot</span> <span class="kn">import</span> <span class="n">show</span>
<span class="kn">from</span> <span class="nn">georeader.rasterio_reader</span> <span class="kn">import</span> <span class="n">RasterioReader</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">georeader.geotensor</span> <span class="kn">import</span> <span class="n">GeoTensor</span>
<span class="kn">from</span> <span class="nn">ml4floods.scripts.inference</span> <span class="kn">import</span> <span class="n">load_inference_function</span><span class="p">,</span> <span class="n">vectorize_outputv1</span>
<span class="kn">from</span> <span class="nn">ml4floods.models.model_setup</span> <span class="kn">import</span> <span class="n">get_channel_configuration_bands</span>
<span class="kn">from</span> <span class="nn">ml4floods.data</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">rasterio.plot</span> <span class="kn">import</span> <span class="n">show</span>
<span class="kn">from</span> <span class="nn">georeader.readers</span> <span class="kn">import</span> <span class="n">ee_image</span>
<span class="kn">from</span> <span class="nn">ml4floods.models</span> <span class="kn">import</span> <span class="n">postprocess</span>
<span class="kn">from</span> <span class="nn">georeader</span> <span class="kn">import</span> <span class="n">plot</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">ml4floods.visualization</span> <span class="kn">import</span> <span class="n">plot_utils</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-2-define-query-parameters-area-of-interest-and-dates">
<h2>Step 2: Define query parameters: area of interest and dates<a class="headerlink" href="#step-2-define-query-parameters-area-of-interest-and-dates" title="Permalink to this heading">#</a></h2>
<p>The area of interest covers the region from Nova Kakhovka to Kherson. The following code defines this AoI and queries the available S2 and Landsat images and shows them using <code class="docutils literal notranslate"><span class="pre">geemap</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aoi</span> <span class="o">=</span> <span class="n">shape</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Polygon&#39;</span><span class="p">,</span>
 <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">(((</span><span class="mf">33.40965055141422</span><span class="p">,</span> <span class="mf">46.849975215311474</span><span class="p">),</span>
   <span class="p">(</span><span class="mf">33.24671826582107</span><span class="p">,</span> <span class="mf">46.923511440491325</span><span class="p">),</span>
   <span class="p">(</span><span class="mf">32.936224664974134</span><span class="p">,</span> <span class="mf">46.845770100334164</span><span class="p">),</span>
   <span class="p">(</span><span class="mf">32.33368262768653</span><span class="p">,</span> <span class="mf">46.62876156455022</span><span class="p">),</span>
   <span class="p">(</span><span class="mf">32.25990197005967</span><span class="p">,</span> <span class="mf">46.514641087646424</span><span class="p">),</span>
   <span class="p">(</span><span class="mf">32.31216326921171</span><span class="p">,</span> <span class="mf">46.408759851523826</span><span class="p">),</span>
   <span class="p">(</span><span class="mf">32.843998842939385</span><span class="p">,</span> <span class="mf">46.56961795883814</span><span class="p">),</span>
   <span class="p">(</span><span class="mf">33.21905051921081</span><span class="p">,</span> <span class="mf">46.72367854887557</span><span class="p">),</span>
   <span class="p">(</span><span class="mf">33.40965055141422</span><span class="p">,</span> <span class="mf">46.849975215311474</span><span class="p">)),)})</span>

<span class="n">aoi_gpd</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span><span class="n">aoi</span><span class="p">},</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tz</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span>
<span class="n">start_period</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;2023-05-31&#39;</span><span class="p">,</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">tz</span><span class="p">)</span>
<span class="n">end_period</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;2023-06-12&#39;</span><span class="p">,</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">tz</span><span class="p">)</span>

<span class="c1"># This function returns a GEE collection of Sentinel-2 and Landsat 8 data and a Geopandas Dataframe with data related to the tiles, overlap percentage and cloud cover</span>
<span class="n">flood_images_gee</span><span class="p">,</span> <span class="n">flood_collection</span> <span class="o">=</span> <span class="n">ee_query</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
    <span class="n">area</span><span class="o">=</span><span class="n">aoi</span><span class="p">,</span> 
    <span class="n">date_start</span><span class="o">=</span><span class="n">start_period</span><span class="p">,</span> 
    <span class="n">date_end</span><span class="o">=</span><span class="n">end_period</span><span class="p">,</span>                                                   
    <span class="n">producttype</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> 
    <span class="n">return_collection</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
    <span class="n">add_s2cloudless</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">flood_images_gee</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;solarday&quot;</span><span class="p">,</span><span class="s2">&quot;satellite&quot;</span><span class="p">])[[</span><span class="s2">&quot;cloudcoverpercentage&quot;</span><span class="p">,</span><span class="s2">&quot;overlappercentage&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">&quot;count&quot;</span><span class="p">,</span><span class="s2">&quot;mean&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/gonzalo/mambaforge/envs/ml4floods2/lib/python3.10/site-packages/geopandas/geoseries.py:645: FutureWarning: the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
  result = super().apply(func, convert_dtype=convert_dtype, args=args, **kwargs)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">cloudcoverpercentage</th>
      <th colspan="2" halign="left">overlappercentage</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>count</th>
      <th>mean</th>
    </tr>
    <tr>
      <th>solarday</th>
      <th>satellite</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2023-05-31</th>
      <th>S2B</th>
      <td>2</td>
      <td>75.062169</td>
      <td>2</td>
      <td>27.434830</td>
    </tr>
    <tr>
      <th>2023-06-01</th>
      <th>LC08</th>
      <td>2</td>
      <td>2.070000</td>
      <td>2</td>
      <td>78.634958</td>
    </tr>
    <tr>
      <th>2023-06-02</th>
      <th>LC09</th>
      <td>1</td>
      <td>16.040000</td>
      <td>1</td>
      <td>75.542523</td>
    </tr>
    <tr>
      <th>2023-06-03</th>
      <th>S2B</th>
      <td>2</td>
      <td>4.788626</td>
      <td>2</td>
      <td>56.100742</td>
    </tr>
    <tr>
      <th>2023-06-05</th>
      <th>S2A</th>
      <td>2</td>
      <td>0.000000</td>
      <td>2</td>
      <td>27.990063</td>
    </tr>
    <tr>
      <th>2023-06-08</th>
      <th>S2A</th>
      <td>2</td>
      <td>95.540035</td>
      <td>2</td>
      <td>56.100742</td>
    </tr>
    <tr>
      <th>2023-06-09</th>
      <th>LC09</th>
      <td>2</td>
      <td>7.760000</td>
      <td>2</td>
      <td>79.054185</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2023-06-10</th>
      <th>LC08</th>
      <td>1</td>
      <td>93.430000</td>
      <td>1</td>
      <td>67.152296</td>
    </tr>
    <tr>
      <th>S2B</th>
      <td>2</td>
      <td>99.942521</td>
      <td>2</td>
      <td>27.707824</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">geemap.foliumap</span> <span class="k">as</span> <span class="nn">geemap</span>
<span class="kn">import</span> <span class="nn">folium</span>

<span class="n">tl</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">TileLayer</span><span class="p">(</span>
            <span class="n">tiles</span><span class="o">=</span><span class="s2">&quot;https://mt1.google.com/vt/lyrs=s&amp;x=</span><span class="si">{x}</span><span class="s2">&amp;y=</span><span class="si">{y}</span><span class="s2">&amp;z=</span><span class="si">{z}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">attr</span><span class="o">=</span><span class="s1">&#39;Google&#39;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Google Satellite&quot;</span><span class="p">,</span>
            <span class="n">overlay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">control</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">max_zoom</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span>
        <span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">geemap</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">aoi</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
               <span class="n">zoom_start</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">tl</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="n">flood_images_gee</span><span class="p">[</span><span class="s2">&quot;localdatetime_str&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flood_images_gee</span><span class="p">[</span><span class="s2">&quot;localdatetime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
<span class="n">showcolumns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span><span class="s2">&quot;overlappercentage&quot;</span><span class="p">,</span><span class="s2">&quot;cloudcoverpercentage&quot;</span><span class="p">,</span> <span class="s2">&quot;localdatetime_str&quot;</span><span class="p">,</span><span class="s2">&quot;solarday&quot;</span><span class="p">,</span><span class="s2">&quot;satellite&quot;</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#ff7777&quot;</span><span class="p">,</span> <span class="s2">&quot;#fffa69&quot;</span><span class="p">,</span> <span class="s2">&quot;#8fff84&quot;</span><span class="p">,</span> <span class="s2">&quot;#52adf1&quot;</span><span class="p">,</span> <span class="s2">&quot;#ff6ac2&quot;</span><span class="p">,</span><span class="s2">&quot;#1b6d52&quot;</span><span class="p">,</span> <span class="s2">&quot;#fce5cd&quot;</span><span class="p">,</span><span class="s2">&quot;#705334&quot;</span><span class="p">]</span>
   
<span class="c1"># Add the extent of the products</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">((</span><span class="n">day</span><span class="p">,</span><span class="n">satellite</span><span class="p">),</span> <span class="n">images_day</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">flood_images_gee</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;solarday&quot;</span><span class="p">,</span><span class="s2">&quot;satellite&quot;</span><span class="p">])):</span>
    <span class="n">images_day</span><span class="p">[</span><span class="n">showcolumns</span><span class="p">]</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span>
        <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> 
        <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">satellite</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2"> outline&quot;</span><span class="p">,</span> 
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)],</span> 
        <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Add the satellite data</span>
<span class="k">for</span> <span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">satellite</span><span class="p">),</span> <span class="n">images_day</span> <span class="ow">in</span> <span class="n">flood_images_gee</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;solarday&quot;</span><span class="p">,</span> <span class="s2">&quot;satellite&quot;</span><span class="p">]):</span>    
    <span class="n">image_col_day_sat</span> <span class="o">=</span> <span class="n">flood_collection</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">inList</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="n">images_day</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>    
    <span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;B11&quot;</span><span class="p">,</span><span class="s2">&quot;B8&quot;</span><span class="p">,</span><span class="s2">&quot;B4&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">satellite</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;S2&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="s2">&quot;B6&quot;</span><span class="p">,</span><span class="s2">&quot;B5&quot;</span><span class="p">,</span><span class="s2">&quot;B4&quot;</span><span class="p">]</span>
    <span class="n">m</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">image_col_day_sat</span><span class="p">,</span> 
               <span class="p">{</span><span class="s2">&quot;min&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span><span class="mi">3000</span> <span class="k">if</span> <span class="n">satellite</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;S2&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;bands&quot;</span><span class="p">:</span> <span class="n">bands</span><span class="p">},</span>
               <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">satellite</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
               <span class="kc">False</span><span class="p">)</span>

<span class="n">aoi_gpd</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">style_kwds</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fillOpacity&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;AoI&quot;</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
<span class="n">folium</span><span class="o">.</span><span class="n">LayerControl</span><span class="p">(</span><span class="n">collapsed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">m</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><iframe srcdoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    
    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;
    
        &lt;script&gt;
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        &lt;/script&gt;
    
    &lt;style&gt;html, body {width: 100%;height: 100%;margin: 0;padding: 0;}&lt;/style&gt;
    &lt;style&gt;#map {position:absolute;top:0;bottom:0;right:0;left:0;}&lt;/style&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/&gt;
    
            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;
            &lt;style&gt;
                #map_a76ce8d44fd50c73c76517c15b1593e0 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            &lt;/style&gt;
        
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet.fullscreen@3.0.0/Control.FullScreen.min.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet.fullscreen@3.0.0/Control.FullScreen.css&quot;/&gt;
    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.css&quot;/&gt;
    &lt;script src=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css&quot;/&gt;
    
                    &lt;style&gt;
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    &lt;/style&gt;
            
    
                    &lt;style&gt;
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    &lt;/style&gt;
            
    
                    &lt;style&gt;
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    &lt;/style&gt;
            
    
                    &lt;style&gt;
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    &lt;/style&gt;
            
    
                    &lt;style&gt;
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    &lt;/style&gt;
            
    
                    &lt;style&gt;
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    &lt;/style&gt;
            
    
                    &lt;style&gt;
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    &lt;/style&gt;
            
    
                    &lt;style&gt;
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    &lt;/style&gt;
            
    
                    &lt;style&gt;
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    &lt;/style&gt;
            
    
                    &lt;style&gt;
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    &lt;/style&gt;
            
&lt;/head&gt;
&lt;body&gt;
    
    
            &lt;div class=&quot;folium-map&quot; id=&quot;map_a76ce8d44fd50c73c76517c15b1593e0&quot; &gt;&lt;/div&gt;
        
&lt;/body&gt;
&lt;script&gt;
    
    
            var map_a76ce8d44fd50c73c76517c15b1593e0 = L.map(
                &quot;map_a76ce8d44fd50c73c76517c15b1593e0&quot;,
                {
                    center: [46.67747714574031, 32.79912830994258],
                    crs: L.CRS.EPSG3857,
                    zoom: 8,
                    zoomControl: true,
                    preferCanvas: false,
                    eeInitialize: true,
                    addGoogleMap: false,
                    pluginLatlngpopup: false,
                    pluginFullscreen: true,
                    pluginDraw: true,
                    DrawExport: false,
                    pluginMinimap: false,
                    locateControl: false,
                    searchControl: true,
                    layersControl: true,
                }
            );

            

        
    
            var tile_layer_aacd68ac16189de300e8ee8bb0590824 = L.tileLayer(
                &quot;https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,
                {&quot;attribution&quot;: &quot;Data by \u0026copy; \u003ca target=\&quot;_blank\&quot; href=\&quot;http://openstreetmap.org\&quot;\u003eOpenStreetMap\u003c/a\u003e, under \u003ca target=\&quot;_blank\&quot; href=\&quot;http://www.openstreetmap.org/copyright\&quot;\u003eODbL\u003c/a\u003e.&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 30, &quot;maxZoom&quot;: 30, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
                tile_layer_aacd68ac16189de300e8ee8bb0590824.addTo(map_a76ce8d44fd50c73c76517c15b1593e0);
    
            L.control.fullscreen(
                {&quot;forceSeparateButton&quot;: false, &quot;position&quot;: &quot;topleft&quot;, &quot;title&quot;: &quot;Full Screen&quot;, &quot;titleCancel&quot;: &quot;Exit Full Screen&quot;}
            ).addTo(map_a76ce8d44fd50c73c76517c15b1593e0);
        
    
            var options = {
              position: &quot;topleft&quot;,
              draw: {},
              edit: {},
            }
            // FeatureGroup is to store editable layers.
            var drawnItems_draw_control_cdfe45d0e720c4b01e1916d45664f47e = new L.featureGroup().addTo(
                map_a76ce8d44fd50c73c76517c15b1593e0
            );
            options.edit.featureGroup = drawnItems_draw_control_cdfe45d0e720c4b01e1916d45664f47e;
            var draw_control_cdfe45d0e720c4b01e1916d45664f47e = new L.Control.Draw(
                options
            ).addTo( map_a76ce8d44fd50c73c76517c15b1593e0 );
            map_a76ce8d44fd50c73c76517c15b1593e0.on(L.Draw.Event.CREATED, function(e) {
                var layer = e.layer,
                    type = e.layerType;
                var coords = JSON.stringify(layer.toGeoJSON());
                layer.on(&#x27;click&#x27;, function() {
                    alert(coords);
                    console.log(coords);
                });
                drawnItems_draw_control_cdfe45d0e720c4b01e1916d45664f47e.addLayer(layer);
             });
            map_a76ce8d44fd50c73c76517c15b1593e0.on(&#x27;draw:created&#x27;, function(e) {
                drawnItems_draw_control_cdfe45d0e720c4b01e1916d45664f47e.addLayer(e.layer);
            });
            
        
    
            L.Control.geocoder(
                {&quot;collapsed&quot;: true, &quot;defaultMarkGeocode&quot;: true, &quot;position&quot;: &quot;topleft&quot;}
            ).on(&#x27;markgeocode&#x27;, function(e) {
                map_a76ce8d44fd50c73c76517c15b1593e0.setView(e.geocode.center, 11);
            }).addTo(map_a76ce8d44fd50c73c76517c15b1593e0);

        
    
            map_a76ce8d44fd50c73c76517c15b1593e0.fitBounds(
                [[46.67747714574031, 32.79912830994258], [46.67747714574031, 32.79912830994258]],
                {&quot;maxZoom&quot;: 8}
            );
        
    
            var tile_layer_df3085beeff72a4e62cf8666767602ff = L.tileLayer(
                &quot;https://mt1.google.com/vt/lyrs=s\u0026x={x}\u0026y={y}\u0026z={z}&quot;,
                {&quot;attribution&quot;: &quot;Google&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 22, &quot;maxZoom&quot;: 22, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
                tile_layer_df3085beeff72a4e62cf8666767602ff.addTo(map_a76ce8d44fd50c73c76517c15b1593e0);
    
        function geo_json_9a918f6d836b01d4f04396f733e77acf_styler(feature) {
            switch(feature.id) {
                default:
                    return {&quot;color&quot;: &quot;#ff7777&quot;, &quot;fillColor&quot;: &quot;#ff7777&quot;, &quot;fillOpacity&quot;: 0.5, &quot;weight&quot;: 2};
            }
        }
        function geo_json_9a918f6d836b01d4f04396f733e77acf_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_9a918f6d836b01d4f04396f733e77acf_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_9a918f6d836b01d4f04396f733e77acf_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_9a918f6d836b01d4f04396f733e77acf_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        geo_json_9a918f6d836b01d4f04396f733e77acf.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_9a918f6d836b01d4f04396f733e77acf_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_9a918f6d836b01d4f04396f733e77acf = L.geoJson(null, {
                onEachFeature: geo_json_9a918f6d836b01d4f04396f733e77acf_onEachFeature,
            
                style: geo_json_9a918f6d836b01d4f04396f733e77acf_styler,
                pointToLayer: geo_json_9a918f6d836b01d4f04396f733e77acf_pointToLayer,
        });

        function geo_json_9a918f6d836b01d4f04396f733e77acf_add (data) {
            geo_json_9a918f6d836b01d4f04396f733e77acf
                .addData(data);
        }
            geo_json_9a918f6d836b01d4f04396f733e77acf_add({&quot;bbox&quot;: [32.60828826013453, 45.9568630400277, 34.442377156260676, 46.953799174536144], &quot;features&quot;: [{&quot;bbox&quot;: [32.99960538265543, 45.9568630400277, 34.442377156260676, 46.953799174536144], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[32.99960636733495, 46.95372046207984], [32.99960538265543, 46.953709171367336], [32.9996123877151, 45.965731170608365], [32.99966505020816, 45.96568971017932], [32.999709790130495, 45.965643996945204], [32.99973104798616, 45.965641160207895], [34.41640039808949, 45.9568630400277], [34.41646096188175, 45.95689886516938], [34.41652750092256, 45.95692911461773], [34.41653191903602, 45.956943856024445], [34.42928491031163, 46.45081002371473], [34.442377156260676, 46.94462310391584], [34.44232478218503, 46.94466524620348], [34.44228045032041, 46.944711510558434], [34.44225880519134, 46.94471455681383], [32.99973713102836, 46.953799174536144], [32.99967640839629, 46.953762621143845], [32.99960945779834, 46.95373148527081], [32.99960636733495, 46.95372046207984]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#ff7777&quot;, &quot;cloudcoverpercentage&quot;: 93.6960793096241, &quot;localdatetime_str&quot;: &quot;2023-05-31 08:47:25&quot;, &quot;overlappercentage&quot;: 28.918844860377774, &quot;satellite&quot;: &quot;S2B&quot;, &quot;solarday&quot;: &quot;2023-05-31&quot;, &quot;title&quot;: &quot;S2B_MSIL1C_20230531T083609_N0509_R064_T36TWS_20230531T091834&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [32.60828826013453, 45.964970211381015, 33.12813598571063, 46.95379111871755], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[32.60834364191016, 45.96501856744163], [32.60839152184263, 45.964970211381015], [33.12570932264478, 45.96557205606584], [33.12576907773165, 45.965608512734], [33.12583898892293, 45.96564149508347], [33.12813598571063, 46.95363750773603], [33.12808245817053, 46.953679004370294], [33.12803426273647, 46.95372756371584], [32.95715663122189, 46.95379111871755], [32.95712750873732, 46.95377359477562], [32.95708930236936, 46.9537784903621], [32.95706328529731, 46.953764687401105], [32.956275131925224, 46.95322441127598], [32.95625256449747, 46.95320360696832], [32.956240647543304, 46.9531826741852], [32.955453936447654, 46.951022476148914], [32.620689110641706, 46.00220467988263], [32.60853661887478, 45.96705654346524], [32.60828826013453, 45.96542484936964], [32.60829076620436, 45.96505985314284], [32.60834364191016, 45.96501856744163]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;1&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#ff7777&quot;, &quot;cloudcoverpercentage&quot;: 56.428258983845, &quot;localdatetime_str&quot;: &quot;2023-05-31 08:47:29&quot;, &quot;overlappercentage&quot;: 25.95081576076203, &quot;satellite&quot;: &quot;S2B&quot;, &quot;solarday&quot;: &quot;2023-05-31&quot;, &quot;title&quot;: &quot;S2B_MSIL1C_20230531T083609_N0509_R064_T36TVS_20230531T091834&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_9a918f6d836b01d4f04396f733e77acf.bindTooltip(
    function(layer){
    let div = L.DomUtil.create(&#x27;div&#x27;);
    
    let handleObject = feature=&gt;typeof(feature)==&#x27;object&#x27; ? JSON.stringify(feature) : feature;
    let fields = [&quot;title&quot;, &quot;overlappercentage&quot;, &quot;cloudcoverpercentage&quot;, &quot;localdatetime_str&quot;, &quot;solarday&quot;, &quot;satellite&quot;];
    let aliases = [&quot;title&quot;, &quot;overlappercentage&quot;, &quot;cloudcoverpercentage&quot;, &quot;localdatetime_str&quot;, &quot;solarday&quot;, &quot;satellite&quot;];
    let table = &#x27;&lt;table&gt;&#x27; +
        String(
        fields.map(
        (v,i)=&gt;
        `&lt;tr&gt;
            &lt;th&gt;${aliases[i]}&lt;/th&gt;
            
            &lt;td&gt;${handleObject(layer.feature.properties[v])}&lt;/td&gt;
        &lt;/tr&gt;`).join(&#x27;&#x27;))
    +&#x27;&lt;/table&gt;&#x27;;
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
    
        function geo_json_f0fb983d53bf07b171a852b58d8c539d_styler(feature) {
            switch(feature.id) {
                default:
                    return {&quot;color&quot;: &quot;#fffa69&quot;, &quot;fillColor&quot;: &quot;#fffa69&quot;, &quot;fillOpacity&quot;: 0.5, &quot;weight&quot;: 2};
            }
        }
        function geo_json_f0fb983d53bf07b171a852b58d8c539d_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_f0fb983d53bf07b171a852b58d8c539d_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_f0fb983d53bf07b171a852b58d8c539d_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_f0fb983d53bf07b171a852b58d8c539d_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        geo_json_f0fb983d53bf07b171a852b58d8c539d.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_f0fb983d53bf07b171a852b58d8c539d_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_f0fb983d53bf07b171a852b58d8c539d = L.geoJson(null, {
                onEachFeature: geo_json_f0fb983d53bf07b171a852b58d8c539d_onEachFeature,
            
                style: geo_json_f0fb983d53bf07b171a852b58d8c539d_styler,
                pointToLayer: geo_json_f0fb983d53bf07b171a852b58d8c539d_pointToLayer,
        });

        function geo_json_f0fb983d53bf07b171a852b58d8c539d_add (data) {
            geo_json_f0fb983d53bf07b171a852b58d8c539d
                .addData(data);
        }
            geo_json_f0fb983d53bf07b171a852b58d8c539d_add({&quot;bbox&quot;: [30.666422913314452, 44.95219925156067, 34.278837305572424, 48.512301521944835], &quot;features&quot;: [{&quot;bbox&quot;: [31.162282808638654, 46.368984957124766, 34.278837305572424, 48.512301521944835], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[33.57908973850119, 46.372266372558386], [33.60534216760113, 46.437697900203815], [33.64759331897992, 46.54276177131436], [33.72173751671756, 46.72623150841848], [33.862606723652156, 47.071841369952914], [33.90154817366706, 47.16670228100198], [34.07200513407607, 47.57810276340625], [34.1318913305318, 47.72142234406115], [34.240470780710766, 47.979839781094576], [34.278837305572424, 48.07062992742776], [34.174269111735335, 48.090420078308426], [33.48050226521335, 48.21889889835711], [32.39320627750726, 48.410607299393945], [31.78773667316308, 48.512301521944835], [31.785391304831016, 48.51227680446856], [31.469144629422, 47.659972710554385], [31.162282808638654, 46.80556392499276], [31.593521868359694, 46.731861183731276], [32.595514748175056, 46.553503904294274], [33.57747094712456, 46.368984957124766], [33.57908973850119, 46.372266372558386]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#fffa69&quot;, &quot;cloudcoverpercentage&quot;: 2.76, &quot;localdatetime_str&quot;: &quot;2023-06-01 08:36:55&quot;, &quot;overlappercentage&quot;: 80.57924328991885, &quot;satellite&quot;: &quot;LC08&quot;, &quot;solarday&quot;: &quot;2023-06-01&quot;, &quot;title&quot;: &quot;LC08_L1TP_179027_20230601_20230607_02_T1&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [30.666422913314452, 44.95219925156067, 33.69366053607057, 47.09135978590796], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[33.39731571913243, 45.91521039449008], [33.43324874066008, 46.0060519060135], [33.528109513468316, 46.244764422480706], [33.62682510646244, 46.49114365997658], [33.69366053607057, 46.65694389270799], [32.30177947469326, 46.91303777945164], [31.58819640078253, 47.03685653676379], [31.26450398187954, 47.09135978590796], [31.110574056135782, 46.66135331107769], [30.960510319260084, 46.23555474445049], [30.81264710708353, 45.80956994764277], [30.666422913314452, 45.38197027670551], [30.67868741773701, 45.379836668856754], [31.06606424752078, 45.3129288618135], [31.96859249625617, 45.151277559220965], [33.02264382561422, 44.95219925156067], [33.07482433494786, 45.08801461085245], [33.123624299012306, 45.21469869598104], [33.214483795010864, 45.4490957715839], [33.35708727805546, 45.81318190402614], [33.39731571913243, 45.91521039449008]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;1&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#fffa69&quot;, &quot;cloudcoverpercentage&quot;: 1.38, &quot;localdatetime_str&quot;: &quot;2023-06-01 08:37:19&quot;, &quot;overlappercentage&quot;: 76.69067251297612, &quot;satellite&quot;: &quot;LC08&quot;, &quot;solarday&quot;: &quot;2023-06-01&quot;, &quot;title&quot;: &quot;LC08_L1TP_179028_20230601_20230607_02_T1&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_f0fb983d53bf07b171a852b58d8c539d.bindTooltip(
    function(layer){
    let div = L.DomUtil.create(&#x27;div&#x27;);
    
    let handleObject = feature=&gt;typeof(feature)==&#x27;object&#x27; ? JSON.stringify(feature) : feature;
    let fields = [&quot;title&quot;, &quot;overlappercentage&quot;, &quot;cloudcoverpercentage&quot;, &quot;localdatetime_str&quot;, &quot;solarday&quot;, &quot;satellite&quot;];
    let aliases = [&quot;title&quot;, &quot;overlappercentage&quot;, &quot;cloudcoverpercentage&quot;, &quot;localdatetime_str&quot;, &quot;solarday&quot;, &quot;satellite&quot;];
    let table = &#x27;&lt;table&gt;&#x27; +
        String(
        fields.map(
        (v,i)=&gt;
        `&lt;tr&gt;
            &lt;th&gt;${aliases[i]}&lt;/th&gt;
            
            &lt;td&gt;${handleObject(layer.feature.properties[v])}&lt;/td&gt;
        &lt;/tr&gt;`).join(&#x27;&#x27;))
    +&#x27;&lt;/table&gt;&#x27;;
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
    
        function geo_json_29cd38dca57f3adbb03cc796a01259b6_styler(feature) {
            switch(feature.id) {
                default:
                    return {&quot;color&quot;: &quot;#8fff84&quot;, &quot;fillColor&quot;: &quot;#8fff84&quot;, &quot;fillOpacity&quot;: 0.5, &quot;weight&quot;: 2};
            }
        }
        function geo_json_29cd38dca57f3adbb03cc796a01259b6_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_29cd38dca57f3adbb03cc796a01259b6_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_29cd38dca57f3adbb03cc796a01259b6_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_29cd38dca57f3adbb03cc796a01259b6_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        geo_json_29cd38dca57f3adbb03cc796a01259b6.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_29cd38dca57f3adbb03cc796a01259b6_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_29cd38dca57f3adbb03cc796a01259b6 = L.geoJson(null, {
                onEachFeature: geo_json_29cd38dca57f3adbb03cc796a01259b6_onEachFeature,
            
                style: geo_json_29cd38dca57f3adbb03cc796a01259b6_styler,
                pointToLayer: geo_json_29cd38dca57f3adbb03cc796a01259b6_pointToLayer,
        });

        function geo_json_29cd38dca57f3adbb03cc796a01259b6_add (data) {
            geo_json_29cd38dca57f3adbb03cc796a01259b6
                .addData(data);
        }
            geo_json_29cd38dca57f3adbb03cc796a01259b6_add({&quot;bbox&quot;: [32.127101190871564, 44.954766648495635, 35.152273676304006, 47.089557755637514], &quot;features&quot;: [{&quot;bbox&quot;: [32.127101190871564, 44.954766648495635, 35.152273676304006, 47.089557755637514], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[32.127101190871564, 45.37997719372664], [32.129405367834934, 45.37945542853335], [32.23713864301273, 45.36118669537116], [34.42443644299829, 44.96597854554397], [34.483111300027474, 44.954766648495635], [34.49291893500948, 44.97937902432158], [34.503941100274645, 45.007996169028274], [34.51927231449787, 45.04789669487053], [34.60307810792499, 45.2654920598099], [34.67946432440049, 45.4628749931064], [34.72695384139264, 45.58530273914162], [34.96065296486946, 46.180570341926014], [35.03649281250504, 46.370812286953736], [35.069449324204385, 46.45324519117801], [35.09796777715005, 46.524409497782685], [35.12988442590162, 46.603986981723374], [35.152273676304006, 46.65977425260528], [35.13364841903142, 46.66335334665748], [33.587418910365486, 46.943222054596724], [32.72205371484659, 47.089557755637514], [32.416796567568994, 46.22593427474693], [32.127101190871564, 45.37997719372664]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#8fff84&quot;, &quot;cloudcoverpercentage&quot;: 16.04, &quot;localdatetime_str&quot;: &quot;2023-06-02 08:31:18&quot;, &quot;overlappercentage&quot;: 75.54252287008404, &quot;satellite&quot;: &quot;LC09&quot;, &quot;solarday&quot;: &quot;2023-06-02&quot;, &quot;title&quot;: &quot;LC09_L1TP_178028_20230602_20230602_02_T1&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_29cd38dca57f3adbb03cc796a01259b6.bindTooltip(
    function(layer){
    let div = L.DomUtil.create(&#x27;div&#x27;);
    
    let handleObject = feature=&gt;typeof(feature)==&#x27;object&#x27; ? JSON.stringify(feature) : feature;
    let fields = [&quot;title&quot;, &quot;overlappercentage&quot;, &quot;cloudcoverpercentage&quot;, &quot;localdatetime_str&quot;, &quot;solarday&quot;, &quot;satellite&quot;];
    let aliases = [&quot;title&quot;, &quot;overlappercentage&quot;, &quot;cloudcoverpercentage&quot;, &quot;localdatetime_str&quot;, &quot;solarday&quot;, &quot;satellite&quot;];
    let table = &#x27;&lt;table&gt;&#x27; +
        String(
        fields.map(
        (v,i)=&gt;
        `&lt;tr&gt;
            &lt;th&gt;${aliases[i]}&lt;/th&gt;
            
            &lt;td&gt;${handleObject(layer.feature.properties[v])}&lt;/td&gt;
        &lt;/tr&gt;`).join(&#x27;&#x27;))
    +&#x27;&lt;/table&gt;&#x27;;
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
    
        function geo_json_b3bd1ee981ac4b71e7b532011571f413_styler(feature) {
            switch(feature.id) {
                default:
                    return {&quot;color&quot;: &quot;#52adf1&quot;, &quot;fillColor&quot;: &quot;#52adf1&quot;, &quot;fillOpacity&quot;: 0.5, &quot;weight&quot;: 2};
            }
        }
        function geo_json_b3bd1ee981ac4b71e7b532011571f413_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_b3bd1ee981ac4b71e7b532011571f413_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_b3bd1ee981ac4b71e7b532011571f413_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_b3bd1ee981ac4b71e7b532011571f413_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        geo_json_b3bd1ee981ac4b71e7b532011571f413.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_b3bd1ee981ac4b71e7b532011571f413_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_b3bd1ee981ac4b71e7b532011571f413 = L.geoJson(null, {
                onEachFeature: geo_json_b3bd1ee981ac4b71e7b532011571f413_onEachFeature,
            
                style: geo_json_b3bd1ee981ac4b71e7b532011571f413_styler,
                pointToLayer: geo_json_b3bd1ee981ac4b71e7b532011571f413_pointToLayer,
        });

        function geo_json_b3bd1ee981ac4b71e7b532011571f413_add (data) {
            geo_json_b3bd1ee981ac4b71e7b532011571f413
                .addData(data);
        }
            geo_json_b3bd1ee981ac4b71e7b532011571f413_add({&quot;bbox&quot;: [31.685307328736148, 45.95834870321066, 34.442377156260676, 46.953799174536144], &quot;features&quot;: [{&quot;bbox&quot;: [31.685307328736148, 45.95834870321066, 33.12813598571063, 46.95372758414584], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[31.708981550809934, 45.958349218126685], [31.708997815925837, 45.95834870321066], [33.12570932264478, 45.96557205606584], [33.12576907773165, 45.965608512734], [33.125834920264815, 45.96563956937199], [33.125838963636916, 45.96565435041944], [33.12813598571063, 46.95363750773603], [33.12808245817053, 46.953679004370294], [33.12803697687828, 46.95372477104928], [33.12801533149519, 46.95372758414584], [31.685437055611228, 46.946252183257265], [31.685377173874038, 46.94621493341922], [31.68531100932444, 46.94618306791813], [31.685307328736148, 46.946168266788476], [31.69724161624959, 46.452321521185205], [31.708866226119696, 45.95843721523441], [31.708919862370433, 45.95839635096429], [31.708965659413145, 45.95835114675201], [31.708981550809934, 45.958349218126685]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#52adf1&quot;, &quot;cloudcoverpercentage&quot;: 6.95114813819463, &quot;localdatetime_str&quot;: &quot;2023-06-03 08:57:25&quot;, &quot;overlappercentage&quot;: 83.2826313479275, &quot;satellite&quot;: &quot;S2B&quot;, &quot;solarday&quot;: &quot;2023-06-03&quot;, &quot;title&quot;: &quot;S2B_MSIL1C_20230603T084559_N0509_R107_T36TVS_20230603T092506&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [32.999605277971334, 45.961035088717345, 34.442377156260676, 46.953799174536144], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[34.442377156260676, 46.94462310391584], [34.44227770905716, 46.944714376278895], [32.99973713102836, 46.953799174536144], [32.999605277971334, 46.953729605171226], [32.9996123877151, 45.965731170608365], [32.999712468661535, 45.965641178067976], [34.02603867879993, 45.961035088717345], [34.02662175037373, 45.96143130511615], [34.027436729724684, 45.96306592830299], [34.03957627807649, 45.99103941815462], [34.04443746046792, 46.002335884238455], [34.076109636487445, 46.07710503914469], [34.16509957465298, 46.28629558031215], [34.26470249216682, 46.518512275217624], [34.357674719894426, 46.73343427732954], [34.426226449535484, 46.89080690227649], [34.44134201885133, 46.925720494614374], [34.44194695160457, 46.92860461163196], [34.442377156260676, 46.94462310391584]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;1&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#52adf1&quot;, &quot;cloudcoverpercentage&quot;: 2.62610392846267, &quot;localdatetime_str&quot;: &quot;2023-06-03 08:57:21&quot;, &quot;overlappercentage&quot;: 28.918853108773284, &quot;satellite&quot;: &quot;S2B&quot;, &quot;solarday&quot;: &quot;2023-06-03&quot;, &quot;title&quot;: &quot;S2B_MSIL1C_20230603T084559_N0509_R107_T36TWS_20230603T092506&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_b3bd1ee981ac4b71e7b532011571f413.bindTooltip(
    function(layer){
    let div = L.DomUtil.create(&#x27;div&#x27;);
    
    let handleObject = feature=&gt;typeof(feature)==&#x27;object&#x27; ? JSON.stringify(feature) : feature;
    let fields = [&quot;title&quot;, &quot;overlappercentage&quot;, &quot;cloudcoverpercentage&quot;, &quot;localdatetime_str&quot;, &quot;solarday&quot;, &quot;satellite&quot;];
    let aliases = [&quot;title&quot;, &quot;overlappercentage&quot;, &quot;cloudcoverpercentage&quot;, &quot;localdatetime_str&quot;, &quot;solarday&quot;, &quot;satellite&quot;];
    let table = &#x27;&lt;table&gt;&#x27; +
        String(
        fields.map(
        (v,i)=&gt;
        `&lt;tr&gt;
            &lt;th&gt;${aliases[i]}&lt;/th&gt;
            
            &lt;td&gt;${handleObject(layer.feature.properties[v])}&lt;/td&gt;
        &lt;/tr&gt;`).join(&#x27;&#x27;))
    +&#x27;&lt;/table&gt;&#x27;;
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
    
        function geo_json_06f5405e4a8ce2790d36824e8829af5e_styler(feature) {
            switch(feature.id) {
                default:
                    return {&quot;color&quot;: &quot;#ff6ac2&quot;, &quot;fillColor&quot;: &quot;#ff6ac2&quot;, &quot;fillOpacity&quot;: 0.5, &quot;weight&quot;: 2};
            }
        }
        function geo_json_06f5405e4a8ce2790d36824e8829af5e_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_06f5405e4a8ce2790d36824e8829af5e_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_06f5405e4a8ce2790d36824e8829af5e_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_06f5405e4a8ce2790d36824e8829af5e_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        geo_json_06f5405e4a8ce2790d36824e8829af5e.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_06f5405e4a8ce2790d36824e8829af5e_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_06f5405e4a8ce2790d36824e8829af5e = L.geoJson(null, {
                onEachFeature: geo_json_06f5405e4a8ce2790d36824e8829af5e_onEachFeature,
            
                style: geo_json_06f5405e4a8ce2790d36824e8829af5e_styler,
                pointToLayer: geo_json_06f5405e4a8ce2790d36824e8829af5e_pointToLayer,
        });

        function geo_json_06f5405e4a8ce2790d36824e8829af5e_add (data) {
            geo_json_06f5405e4a8ce2790d36824e8829af5e
                .addData(data);
        }
            geo_json_06f5405e4a8ce2790d36824e8829af5e_add({&quot;bbox&quot;: [32.5992460196104, 45.9568630400277, 34.442377156260676, 46.953799174536144], &quot;features&quot;: [{&quot;bbox&quot;: [32.99960538265543, 45.9568630400277, 34.442377156260676, 46.953799174536144], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[32.99960636733495, 46.95372046207984], [32.99960538265543, 46.953709171367336], [32.9996123877151, 45.965731170608365], [32.99966505020816, 45.96568971017932], [32.999709790130495, 45.965643996945204], [32.99973104798616, 45.965641160207895], [34.41640039808949, 45.9568630400277], [34.41646096188175, 45.95689886516938], [34.41652750092256, 45.95692911461773], [34.41653191903602, 45.956943856024445], [34.42928491031163, 46.45081002371473], [34.442377156260676, 46.94462310391584], [34.44232478218503, 46.94466524620348], [34.44228045032041, 46.944711510558434], [34.44225880519134, 46.94471455681383], [32.99973713102836, 46.953799174536144], [32.99967640839629, 46.953762621143845], [32.99960945779834, 46.95373148527081], [32.99960636733495, 46.95372046207984]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#ff6ac2&quot;, &quot;cloudcoverpercentage&quot;: 0.0, &quot;localdatetime_str&quot;: &quot;2023-06-05 08:47:24&quot;, &quot;overlappercentage&quot;: 28.918844860377774, &quot;satellite&quot;: &quot;S2A&quot;, &quot;solarday&quot;: &quot;2023-06-05&quot;, &quot;title&quot;: &quot;S2A_MSIL1C_20230605T083601_N0509_R064_T36TWS_20230605T103946&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [32.5992460196104, 45.9649407370654, 33.12813598571063, 46.9537872282422], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[32.94757826821553, 46.953739921483965], [32.94756645749274, 46.953718954382005], [32.94442117080633, 46.94507842884313], [32.92792628348984, 46.89917477904354], [32.60455885403646, 45.982169026098354], [32.5992460196104, 45.96647923437698], [32.599253876434744, 45.96538856732948], [32.5992743734477, 45.965337386490816], [32.59981100564648, 45.96496695807112], [32.59987784672964, 45.9649407370654], [33.12570932264478, 45.96557205606584], [33.12583898892293, 45.96564149508347], [33.12813598571063, 46.95363750773603], [33.12803426273647, 46.95372756371584], [32.94769424246526, 46.9537872282422], [32.94764281325823, 46.953756190862244], [32.94757826821553, 46.953739921483965]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;1&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#ff6ac2&quot;, &quot;cloudcoverpercentage&quot;: 0.0, &quot;localdatetime_str&quot;: &quot;2023-06-05 08:47:28&quot;, &quot;overlappercentage&quot;: 27.0612820471078, &quot;satellite&quot;: &quot;S2A&quot;, &quot;solarday&quot;: &quot;2023-06-05&quot;, &quot;title&quot;: &quot;S2A_MSIL1C_20230605T083601_N0509_R064_T36TVS_20230605T103946&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_06f5405e4a8ce2790d36824e8829af5e.bindTooltip(
    function(layer){
    let div = L.DomUtil.create(&#x27;div&#x27;);
    
    let handleObject = feature=&gt;typeof(feature)==&#x27;object&#x27; ? JSON.stringify(feature) : feature;
    let fields = [&quot;title&quot;, &quot;overlappercentage&quot;, &quot;cloudcoverpercentage&quot;, &quot;localdatetime_str&quot;, &quot;solarday&quot;, &quot;satellite&quot;];
    let aliases = [&quot;title&quot;, &quot;overlappercentage&quot;, &quot;cloudcoverpercentage&quot;, &quot;localdatetime_str&quot;, &quot;solarday&quot;, &quot;satellite&quot;];
    let table = &#x27;&lt;table&gt;&#x27; +
        String(
        fields.map(
        (v,i)=&gt;
        `&lt;tr&gt;
            &lt;th&gt;${aliases[i]}&lt;/th&gt;
            
            &lt;td&gt;${handleObject(layer.feature.properties[v])}&lt;/td&gt;
        &lt;/tr&gt;`).join(&#x27;&#x27;))
    +&#x27;&lt;/table&gt;&#x27;;
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
    
        function geo_json_768c2c02c231fd0bb5f321e7bfc770ac_styler(feature) {
            switch(feature.id) {
                default:
                    return {&quot;color&quot;: &quot;#1b6d52&quot;, &quot;fillColor&quot;: &quot;#1b6d52&quot;, &quot;fillOpacity&quot;: 0.5, &quot;weight&quot;: 2};
            }
        }
        function geo_json_768c2c02c231fd0bb5f321e7bfc770ac_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_768c2c02c231fd0bb5f321e7bfc770ac_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_768c2c02c231fd0bb5f321e7bfc770ac_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_768c2c02c231fd0bb5f321e7bfc770ac_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        geo_json_768c2c02c231fd0bb5f321e7bfc770ac.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_768c2c02c231fd0bb5f321e7bfc770ac_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_768c2c02c231fd0bb5f321e7bfc770ac = L.geoJson(null, {
                onEachFeature: geo_json_768c2c02c231fd0bb5f321e7bfc770ac_onEachFeature,
            
                style: geo_json_768c2c02c231fd0bb5f321e7bfc770ac_styler,
                pointToLayer: geo_json_768c2c02c231fd0bb5f321e7bfc770ac_pointToLayer,
        });

        function geo_json_768c2c02c231fd0bb5f321e7bfc770ac_add (data) {
            geo_json_768c2c02c231fd0bb5f321e7bfc770ac
                .addData(data);
        }
            geo_json_768c2c02c231fd0bb5f321e7bfc770ac_add({&quot;bbox&quot;: [31.685307328736148, 45.95834870321066, 34.442377156260676, 46.953799174536144], &quot;features&quot;: [{&quot;bbox&quot;: [31.685307328736148, 45.95834870321066, 33.12813598571063, 46.95372758414584], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[31.708981550809934, 45.958349218126685], [31.708997815925837, 45.95834870321066], [33.12570932264478, 45.96557205606584], [33.12576907773165, 45.965608512734], [33.125834920264815, 45.96563956937199], [33.125838963636916, 45.96565435041944], [33.12813598571063, 46.95363750773603], [33.12808245817053, 46.953679004370294], [33.12803697687828, 46.95372477104928], [33.12801533149519, 46.95372758414584], [31.685437055611228, 46.946252183257265], [31.685377173874038, 46.94621493341922], [31.68531100932444, 46.94618306791813], [31.685307328736148, 46.946168266788476], [31.69724161624959, 46.452321521185205], [31.708866226119696, 45.95843721523441], [31.708919862370433, 45.95839635096429], [31.708965659413145, 45.95835114675201], [31.708981550809934, 45.958349218126685]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#1b6d52&quot;, &quot;cloudcoverpercentage&quot;: 91.0901490041506, &quot;localdatetime_str&quot;: &quot;2023-06-08 08:57:25&quot;, &quot;overlappercentage&quot;: 83.2826313479275, &quot;satellite&quot;: &quot;S2A&quot;, &quot;solarday&quot;: &quot;2023-06-08&quot;, &quot;title&quot;: &quot;S2A_MSIL1C_20230608T084601_N0509_R107_T36TVS_20230608T104959&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [32.999605277971334, 45.961062804368936, 34.442377156260676, 46.953799174536144], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[34.442377156260676, 46.94462310391584], [34.44227770905716, 46.944714376278895], [32.99973713102836, 46.953799174536144], [32.999605277971334, 46.953729605171226], [32.9996123877151, 45.965731170608365], [32.999712468661535, 45.965641178067976], [34.02294181911364, 45.961062804368936], [34.02313283334165, 45.96119259653103], [34.02354583692197, 45.96202108233765], [34.04785781175441, 46.01931541424416], [34.2624105843512, 46.52087740640489], [34.29192976936469, 46.58912464370783], [34.32263607410762, 46.6600497190125], [34.40883432721936, 46.85826535666799], [34.43901897399783, 46.92736306953399], [34.44181963070962, 46.933808411790764], [34.44210626490457, 46.9345365723729], [34.442377156260676, 46.94462310391584]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;1&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#1b6d52&quot;, &quot;cloudcoverpercentage&quot;: 99.9899200008313, &quot;localdatetime_str&quot;: &quot;2023-06-08 08:57:20&quot;, &quot;overlappercentage&quot;: 28.918853108773284, &quot;satellite&quot;: &quot;S2A&quot;, &quot;solarday&quot;: &quot;2023-06-08&quot;, &quot;title&quot;: &quot;S2A_MSIL1C_20230608T084601_N0509_R107_T36TWS_20230608T104959&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_768c2c02c231fd0bb5f321e7bfc770ac.bindTooltip(
    function(layer){
    let div = L.DomUtil.create(&#x27;div&#x27;);
    
    let handleObject = feature=&gt;typeof(feature)==&#x27;object&#x27; ? JSON.stringify(feature) : feature;
    let fields = [&quot;title&quot;, &quot;overlappercentage&quot;, &quot;cloudcoverpercentage&quot;, &quot;localdatetime_str&quot;, &quot;solarday&quot;, &quot;satellite&quot;];
    let aliases = [&quot;title&quot;, &quot;overlappercentage&quot;, &quot;cloudcoverpercentage&quot;, &quot;localdatetime_str&quot;, &quot;solarday&quot;, &quot;satellite&quot;];
    let table = &#x27;&lt;table&gt;&#x27; +
        String(
        fields.map(
        (v,i)=&gt;
        `&lt;tr&gt;
            &lt;th&gt;${aliases[i]}&lt;/th&gt;
            
            &lt;td&gt;${handleObject(layer.feature.properties[v])}&lt;/td&gt;
        &lt;/tr&gt;`).join(&#x27;&#x27;))
    +&#x27;&lt;/table&gt;&#x27;;
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
    
        function geo_json_22b371462f57f1c795801c5c851b5537_styler(feature) {
            switch(feature.id) {
                default:
                    return {&quot;color&quot;: &quot;#fce5cd&quot;, &quot;fillColor&quot;: &quot;#fce5cd&quot;, &quot;fillOpacity&quot;: 0.5, &quot;weight&quot;: 2};
            }
        }
        function geo_json_22b371462f57f1c795801c5c851b5537_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_22b371462f57f1c795801c5c851b5537_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_22b371462f57f1c795801c5c851b5537_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_22b371462f57f1c795801c5c851b5537_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        geo_json_22b371462f57f1c795801c5c851b5537.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_22b371462f57f1c795801c5c851b5537_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_22b371462f57f1c795801c5c851b5537 = L.geoJson(null, {
                onEachFeature: geo_json_22b371462f57f1c795801c5c851b5537_onEachFeature,
            
                style: geo_json_22b371462f57f1c795801c5c851b5537_styler,
                pointToLayer: geo_json_22b371462f57f1c795801c5c851b5537_pointToLayer,
        });

        function geo_json_22b371462f57f1c795801c5c851b5537_add (data) {
            geo_json_22b371462f57f1c795801c5c851b5537
                .addData(data);
        }
            geo_json_22b371462f57f1c795801c5c851b5537_add({&quot;bbox&quot;: [30.57643201291285, 44.95417470586244, 34.18380152005265, 48.51089380472621], &quot;features&quot;: [{&quot;bbox&quot;: [31.06976440666409, 46.37125076498086, 34.18380152005265, 48.51089380472621], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[34.158797578234555, 48.014024921085884], [34.18380152005265, 48.07337021874152], [34.181709161245365, 48.07409855517649], [33.670680969497205, 48.168688567185484], [32.98855875985549, 48.290887115432454], [32.043978384377844, 48.45249913323468], [31.689454377259597, 48.51089380472621], [31.382545396421328, 47.67916484634492], [31.08566455059173, 46.848712338717434], [31.06976440666409, 46.80335695642533], [31.08514684107649, 46.800752080107834], [33.12183092618958, 46.44008466906691], [33.48593189977051, 46.37125076498086], [33.506768333462944, 46.42340651569698], [33.584270168029164, 46.61687359397547], [33.70344324747589, 46.91230058750673], [33.75434394365952, 47.03752933188445], [33.977439430855746, 47.58004585420242], [34.008810847598824, 47.65549171202019], [34.06931059400419, 47.800707579834906], [34.158797578234555, 48.014024921085884]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#fce5cd&quot;, &quot;cloudcoverpercentage&quot;: 1.84, &quot;localdatetime_str&quot;: &quot;2023-06-09 08:37:02&quot;, &quot;overlappercentage&quot;: 83.97508839525474, &quot;satellite&quot;: &quot;LC09&quot;, &quot;solarday&quot;: &quot;2023-06-09&quot;, &quot;title&quot;: &quot;LC09_L1TP_179027_20230609_20230610_02_T1&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [30.57643201291285, 44.95417470586244, 33.601129677264666, 47.08916009028895], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[33.59912602017405, 46.65399013484693], [33.601129677264666, 46.65933517806523], [33.597101722465936, 46.66028315103898], [32.58831416208799, 46.84571965439137], [31.36009876363347, 47.057844008961844], [31.171120940794857, 47.08916009028895], [31.01735074081896, 46.65707542576817], [30.868692086658367, 46.23279915767407], [30.722200151197367, 45.8083418552304], [30.57643201291285, 45.3796502611704], [30.578461724952767, 45.37898812441318], [31.786769875486243, 45.16785391685317], [32.43959919194894, 45.04775405571635], [32.932922540484746, 44.95417470586244], [32.93394016100983, 44.955622720157905], [33.01013992045649, 45.15494931654289], [33.140935495378756, 45.49390108879174], [33.205667747135706, 45.660454539067], [33.37708087544004, 46.09726591173508], [33.492618213743334, 46.38802059975971], [33.57254900686113, 46.58770944671649], [33.59268344960542, 46.63784326907219], [33.59912602017405, 46.65399013484693]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;1&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#fce5cd&quot;, &quot;cloudcoverpercentage&quot;: 13.68, &quot;localdatetime_str&quot;: &quot;2023-06-09 08:37:25&quot;, &quot;overlappercentage&quot;: 74.13328123644125, &quot;satellite&quot;: &quot;LC09&quot;, &quot;solarday&quot;: &quot;2023-06-09&quot;, &quot;title&quot;: &quot;LC09_L1TP_179028_20230609_20230610_02_T1&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_22b371462f57f1c795801c5c851b5537.bindTooltip(
    function(layer){
    let div = L.DomUtil.create(&#x27;div&#x27;);
    
    let handleObject = feature=&gt;typeof(feature)==&#x27;object&#x27; ? JSON.stringify(feature) : feature;
    let fields = [&quot;title&quot;, &quot;overlappercentage&quot;, &quot;cloudcoverpercentage&quot;, &quot;localdatetime_str&quot;, &quot;solarday&quot;, &quot;satellite&quot;];
    let aliases = [&quot;title&quot;, &quot;overlappercentage&quot;, &quot;cloudcoverpercentage&quot;, &quot;localdatetime_str&quot;, &quot;solarday&quot;, &quot;satellite&quot;];
    let table = &#x27;&lt;table&gt;&#x27; +
        String(
        fields.map(
        (v,i)=&gt;
        `&lt;tr&gt;
            &lt;th&gt;${aliases[i]}&lt;/th&gt;
            
            &lt;td&gt;${handleObject(layer.feature.properties[v])}&lt;/td&gt;
        &lt;/tr&gt;`).join(&#x27;&#x27;))
    +&#x27;&lt;/table&gt;&#x27;;
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
    
        function geo_json_3141e9aac94905e66ebce956cb380856_styler(feature) {
            switch(feature.id) {
                default:
                    return {&quot;color&quot;: &quot;#705334&quot;, &quot;fillColor&quot;: &quot;#705334&quot;, &quot;fillOpacity&quot;: 0.5, &quot;weight&quot;: 2};
            }
        }
        function geo_json_3141e9aac94905e66ebce956cb380856_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_3141e9aac94905e66ebce956cb380856_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_3141e9aac94905e66ebce956cb380856_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_3141e9aac94905e66ebce956cb380856_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        geo_json_3141e9aac94905e66ebce956cb380856.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_3141e9aac94905e66ebce956cb380856_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_3141e9aac94905e66ebce956cb380856 = L.geoJson(null, {
                onEachFeature: geo_json_3141e9aac94905e66ebce956cb380856_onEachFeature,
            
                style: geo_json_3141e9aac94905e66ebce956cb380856_styler,
                pointToLayer: geo_json_3141e9aac94905e66ebce956cb380856_pointToLayer,
        });

        function geo_json_3141e9aac94905e66ebce956cb380856_add (data) {
            geo_json_3141e9aac94905e66ebce956cb380856
                .addData(data);
        }
            geo_json_3141e9aac94905e66ebce956cb380856_add({&quot;bbox&quot;: [32.1998659866188, 44.95279310650238, 35.227052936345615, 47.09121819654378], &quot;features&quot;: [{&quot;bbox&quot;: [32.1998659866188, 44.95279310650238, 35.227052936345615, 47.09121819654378], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[34.55285781966303, 44.95282258301872], [34.5550225202863, 44.95279310650238], [34.57294501330233, 44.99726294458921], [34.584813785989226, 45.027831634231994], [34.61438674342607, 45.10438313419144], [34.67565334901838, 45.2626947937385], [34.70237760143531, 45.33156597215288], [34.74165897435643, 45.432644189686606], [34.93843169914924, 45.93496744448095], [35.07233378667271, 46.27161698139279], [35.126479958334755, 46.406891699769226], [35.22174050869619, 46.64343385349994], [35.227052936345615, 46.65685724213668], [32.80916706607027, 47.08940471457099], [32.79775360536887, 47.09121819654378], [32.49098554872311, 46.22777366135044], [32.1998659866188, 45.38196518330006], [32.24136074913726, 45.3748519089863], [34.00188461895684, 45.058236444205534], [34.55285781966303, 44.95282258301872]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#705334&quot;, &quot;cloudcoverpercentage&quot;: 93.43, &quot;localdatetime_str&quot;: &quot;2023-06-10 08:31:15&quot;, &quot;overlappercentage&quot;: 67.15229606992659, &quot;satellite&quot;: &quot;LC08&quot;, &quot;solarday&quot;: &quot;2023-06-10&quot;, &quot;title&quot;: &quot;LC08_L1TP_178028_20230610_20230614_02_T1&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_3141e9aac94905e66ebce956cb380856.bindTooltip(
    function(layer){
    let div = L.DomUtil.create(&#x27;div&#x27;);
    
    let handleObject = feature=&gt;typeof(feature)==&#x27;object&#x27; ? JSON.stringify(feature) : feature;
    let fields = [&quot;title&quot;, &quot;overlappercentage&quot;, &quot;cloudcoverpercentage&quot;, &quot;localdatetime_str&quot;, &quot;solarday&quot;, &quot;satellite&quot;];
    let aliases = [&quot;title&quot;, &quot;overlappercentage&quot;, &quot;cloudcoverpercentage&quot;, &quot;localdatetime_str&quot;, &quot;solarday&quot;, &quot;satellite&quot;];
    let table = &#x27;&lt;table&gt;&#x27; +
        String(
        fields.map(
        (v,i)=&gt;
        `&lt;tr&gt;
            &lt;th&gt;${aliases[i]}&lt;/th&gt;
            
            &lt;td&gt;${handleObject(layer.feature.properties[v])}&lt;/td&gt;
        &lt;/tr&gt;`).join(&#x27;&#x27;))
    +&#x27;&lt;/table&gt;&#x27;;
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
    
        function geo_json_a8691345712463a7c3a6d8e5b7f60474_styler(feature) {
            switch(feature.id) {
                default:
                    return {&quot;color&quot;: &quot;#ff7777&quot;, &quot;fillColor&quot;: &quot;#ff7777&quot;, &quot;fillOpacity&quot;: 0.5, &quot;weight&quot;: 2};
            }
        }
        function geo_json_a8691345712463a7c3a6d8e5b7f60474_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_a8691345712463a7c3a6d8e5b7f60474_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_a8691345712463a7c3a6d8e5b7f60474_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_a8691345712463a7c3a6d8e5b7f60474_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        geo_json_a8691345712463a7c3a6d8e5b7f60474.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_a8691345712463a7c3a6d8e5b7f60474_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_a8691345712463a7c3a6d8e5b7f60474 = L.geoJson(null, {
                onEachFeature: geo_json_a8691345712463a7c3a6d8e5b7f60474_onEachFeature,
            
                style: geo_json_a8691345712463a7c3a6d8e5b7f60474_styler,
                pointToLayer: geo_json_a8691345712463a7c3a6d8e5b7f60474_pointToLayer,
        });

        function geo_json_a8691345712463a7c3a6d8e5b7f60474_add (data) {
            geo_json_a8691345712463a7c3a6d8e5b7f60474
                .addData(data);
        }
            geo_json_a8691345712463a7c3a6d8e5b7f60474_add({&quot;bbox&quot;: [32.604670516174856, 45.9568630400277, 34.442377156260676, 46.953799174536144], &quot;features&quot;: [{&quot;bbox&quot;: [32.99960538265543, 45.9568630400277, 34.442377156260676, 46.953799174536144], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[32.99960636733495, 46.95372046207984], [32.99960538265543, 46.953709171367336], [32.9996123877151, 45.965731170608365], [32.99966505020816, 45.96568971017932], [32.999709790130495, 45.965643996945204], [32.99973104798616, 45.965641160207895], [34.41640039808949, 45.9568630400277], [34.41646096188175, 45.95689886516938], [34.41652750092256, 45.95692911461773], [34.41653191903602, 45.956943856024445], [34.42928491031163, 46.45081002371473], [34.442377156260676, 46.94462310391584], [34.44232478218503, 46.94466524620348], [34.44228045032041, 46.944711510558434], [34.44225880519134, 46.94471455681383], [32.99973713102836, 46.953799174536144], [32.99967640839629, 46.953762621143845], [32.99960945779834, 46.95373148527081], [32.99960636733495, 46.95372046207984]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#ff7777&quot;, &quot;cloudcoverpercentage&quot;: 99.9860252620263, &quot;localdatetime_str&quot;: &quot;2023-06-10 08:47:26&quot;, &quot;overlappercentage&quot;: 28.918844860377774, &quot;satellite&quot;: &quot;S2B&quot;, &quot;solarday&quot;: &quot;2023-06-10&quot;, &quot;title&quot;: &quot;S2B_MSIL1C_20230610T083609_N0509_R064_T36TWS_20230610T091752&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [32.604670516174856, 45.96495875972809, 33.12813598571063, 46.953789737423854], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[33.12576907773165, 45.965608512734], [33.12583898892293, 45.96564149508347], [33.12813598571063, 46.95363750773603], [33.12808245817053, 46.953679004370294], [33.12803426273647, 46.95372756371584], [32.95347677740418, 46.953789737423854], [32.953428353447606, 46.95376046552208], [32.95336604562375, 46.95374836672223], [32.95335174429832, 46.953728039002044], [32.9530878123267, 46.953184773754344], [32.931870463151725, 46.89485784596079], [32.852919238891886, 46.673945419992044], [32.61681840983426, 46.00165160330048], [32.604670516174856, 45.965958138664554], [32.6046763686671, 45.96513741207349], [32.60471376429078, 45.96510828654029], [32.60472136451609, 45.965069649358725], [32.60474837306285, 45.96505720925649], [32.60502433198986, 45.96496219703961], [32.605065241673316, 45.96495875972809], [33.12570932264478, 45.96557205606584], [33.12576907773165, 45.965608512734]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;1&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#ff7777&quot;, &quot;cloudcoverpercentage&quot;: 99.8990173137628, &quot;localdatetime_str&quot;: &quot;2023-06-10 08:47:30&quot;, &quot;overlappercentage&quot;: 26.49680380323966, &quot;satellite&quot;: &quot;S2B&quot;, &quot;solarday&quot;: &quot;2023-06-10&quot;, &quot;title&quot;: &quot;S2B_MSIL1C_20230610T083609_N0509_R064_T36TVS_20230610T091752&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_a8691345712463a7c3a6d8e5b7f60474.bindTooltip(
    function(layer){
    let div = L.DomUtil.create(&#x27;div&#x27;);
    
    let handleObject = feature=&gt;typeof(feature)==&#x27;object&#x27; ? JSON.stringify(feature) : feature;
    let fields = [&quot;title&quot;, &quot;overlappercentage&quot;, &quot;cloudcoverpercentage&quot;, &quot;localdatetime_str&quot;, &quot;solarday&quot;, &quot;satellite&quot;];
    let aliases = [&quot;title&quot;, &quot;overlappercentage&quot;, &quot;cloudcoverpercentage&quot;, &quot;localdatetime_str&quot;, &quot;solarday&quot;, &quot;satellite&quot;];
    let table = &#x27;&lt;table&gt;&#x27; +
        String(
        fields.map(
        (v,i)=&gt;
        `&lt;tr&gt;
            &lt;th&gt;${aliases[i]}&lt;/th&gt;
            
            &lt;td&gt;${handleObject(layer.feature.properties[v])}&lt;/td&gt;
        &lt;/tr&gt;`).join(&#x27;&#x27;))
    +&#x27;&lt;/table&gt;&#x27;;
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
    
            var tile_layer_0f8185ee91bf471751556c6d71895a30 = L.tileLayer(
                &quot;https://earthengine.googleapis.com/v1/projects/earthengine-legacy/maps/b2d77968162b3fc2eb9726590b59b17f-dad5260bffb006d4e7e1b2eb10a4a33d/tiles/{z}/{x}/{y}&quot;,
                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            var tile_layer_c68ff13948e91149229bc7bbf6ab1388 = L.tileLayer(
                &quot;https://earthengine.googleapis.com/v1/projects/earthengine-legacy/maps/72a5cdbf3ab3766881bf2be7457dc689-79444133da4a95e7be852ac778153b61/tiles/{z}/{x}/{y}&quot;,
                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            var tile_layer_46b030165fe62e69e131f90944077d95 = L.tileLayer(
                &quot;https://earthengine.googleapis.com/v1/projects/earthengine-legacy/maps/a544fd6abb9a2645c53576bcf5998af1-8f6b4e170b598f9f55306c92ccc743c1/tiles/{z}/{x}/{y}&quot;,
                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            var tile_layer_322690220165132106960efccb1c8877 = L.tileLayer(
                &quot;https://earthengine.googleapis.com/v1/projects/earthengine-legacy/maps/ff934c4be2cd4eaa734e327ee7ffc09c-c9b818aee068922e5293c89899560556/tiles/{z}/{x}/{y}&quot;,
                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            var tile_layer_4eeb2b4af5ee54005c4f7406e38c85c8 = L.tileLayer(
                &quot;https://earthengine.googleapis.com/v1/projects/earthengine-legacy/maps/fac12bf3e9a1d97d4ab3fd5c6d50b26f-1c0337e6a4830a0145ab3d173822fbd0/tiles/{z}/{x}/{y}&quot;,
                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            var tile_layer_0133c2a8df1009366e06a22cf11d4fb0 = L.tileLayer(
                &quot;https://earthengine.googleapis.com/v1/projects/earthengine-legacy/maps/8118b0cbc98bbb623836ddb82b890031-ce1f54fe1d8950bd5630a424fc7420d1/tiles/{z}/{x}/{y}&quot;,
                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            var tile_layer_64091a770c46bafeacf5a899ccb4ee95 = L.tileLayer(
                &quot;https://earthengine.googleapis.com/v1/projects/earthengine-legacy/maps/9a1c0bbe8c84fdaee9d2bc3a7685b7d7-a91f88db13b553bdf15277c9f847809b/tiles/{z}/{x}/{y}&quot;,
                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            var tile_layer_5d5729a95aa32782c37ba1aa13fca188 = L.tileLayer(
                &quot;https://earthengine.googleapis.com/v1/projects/earthengine-legacy/maps/a5b00ffc817b3b55b432cc29900d0557-f1bb43dac727f581b0f7985a25067453/tiles/{z}/{x}/{y}&quot;,
                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            var tile_layer_f89e6cc4f9af440816578f9b0368d76f = L.tileLayer(
                &quot;https://earthengine.googleapis.com/v1/projects/earthengine-legacy/maps/06848ccdba0485c384fa19d3f96693e9-435ae301bcb70672671a0b7793be5ce2/tiles/{z}/{x}/{y}&quot;,
                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
        function geo_json_d1bcd93f006329f4f6afdaf8c4050da4_styler(feature) {
            switch(feature.id) {
                default:
                    return {&quot;color&quot;: &quot;black&quot;, &quot;fillColor&quot;: &quot;black&quot;, &quot;fillOpacity&quot;: 0, &quot;weight&quot;: 2};
            }
        }
        function geo_json_d1bcd93f006329f4f6afdaf8c4050da4_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_d1bcd93f006329f4f6afdaf8c4050da4_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_d1bcd93f006329f4f6afdaf8c4050da4_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_d1bcd93f006329f4f6afdaf8c4050da4_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        geo_json_d1bcd93f006329f4f6afdaf8c4050da4.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_d1bcd93f006329f4f6afdaf8c4050da4_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_d1bcd93f006329f4f6afdaf8c4050da4 = L.geoJson(null, {
                onEachFeature: geo_json_d1bcd93f006329f4f6afdaf8c4050da4_onEachFeature,
            
                style: geo_json_d1bcd93f006329f4f6afdaf8c4050da4_styler,
                pointToLayer: geo_json_d1bcd93f006329f4f6afdaf8c4050da4_pointToLayer,
        });

        function geo_json_d1bcd93f006329f4f6afdaf8c4050da4_add (data) {
            geo_json_d1bcd93f006329f4f6afdaf8c4050da4
                .addData(data);
        }
            geo_json_d1bcd93f006329f4f6afdaf8c4050da4_add({&quot;bbox&quot;: [32.25990197005967, 46.408759851523826, 33.40965055141422, 46.923511440491325], &quot;features&quot;: [{&quot;bbox&quot;: [32.25990197005967, 46.408759851523826, 33.40965055141422, 46.923511440491325], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[33.40965055141422, 46.849975215311474], [33.24671826582107, 46.923511440491325], [32.936224664974134, 46.845770100334164], [32.33368262768653, 46.62876156455022], [32.25990197005967, 46.514641087646424], [32.31216326921171, 46.408759851523826], [32.843998842939385, 46.56961795883814], [33.21905051921081, 46.72367854887557], [33.40965055141422, 46.849975215311474]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;black&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_d1bcd93f006329f4f6afdaf8c4050da4.bindTooltip(
    function(layer){
    let div = L.DomUtil.create(&#x27;div&#x27;);
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
    
                geo_json_d1bcd93f006329f4f6afdaf8c4050da4.addTo(map_a76ce8d44fd50c73c76517c15b1593e0);
    
            var layer_control_945c10320594d589a1d8f50cb9260014_layers = {
                base_layers : {
                    &quot;openstreetmap&quot; : tile_layer_aacd68ac16189de300e8ee8bb0590824,
                },
                overlays :  {
                    &quot;Google Satellite&quot; : tile_layer_df3085beeff72a4e62cf8666767602ff,
                    &quot;S2B: 2023-05-31 outline&quot; : geo_json_9a918f6d836b01d4f04396f733e77acf,
                    &quot;LC08: 2023-06-01 outline&quot; : geo_json_f0fb983d53bf07b171a852b58d8c539d,
                    &quot;LC09: 2023-06-02 outline&quot; : geo_json_29cd38dca57f3adbb03cc796a01259b6,
                    &quot;S2B: 2023-06-03 outline&quot; : geo_json_b3bd1ee981ac4b71e7b532011571f413,
                    &quot;S2A: 2023-06-05 outline&quot; : geo_json_06f5405e4a8ce2790d36824e8829af5e,
                    &quot;S2A: 2023-06-08 outline&quot; : geo_json_768c2c02c231fd0bb5f321e7bfc770ac,
                    &quot;LC09: 2023-06-09 outline&quot; : geo_json_22b371462f57f1c795801c5c851b5537,
                    &quot;LC08: 2023-06-10 outline&quot; : geo_json_3141e9aac94905e66ebce956cb380856,
                    &quot;S2B: 2023-06-10 outline&quot; : geo_json_a8691345712463a7c3a6d8e5b7f60474,
                    &quot;S2B: 2023-05-31&quot; : tile_layer_0f8185ee91bf471751556c6d71895a30,
                    &quot;LC08: 2023-06-01&quot; : tile_layer_c68ff13948e91149229bc7bbf6ab1388,
                    &quot;LC09: 2023-06-02&quot; : tile_layer_46b030165fe62e69e131f90944077d95,
                    &quot;S2B: 2023-06-03&quot; : tile_layer_322690220165132106960efccb1c8877,
                    &quot;S2A: 2023-06-05&quot; : tile_layer_4eeb2b4af5ee54005c4f7406e38c85c8,
                    &quot;S2A: 2023-06-08&quot; : tile_layer_0133c2a8df1009366e06a22cf11d4fb0,
                    &quot;LC09: 2023-06-09&quot; : tile_layer_64091a770c46bafeacf5a899ccb4ee95,
                    &quot;LC08: 2023-06-10&quot; : tile_layer_5d5729a95aa32782c37ba1aa13fca188,
                    &quot;S2B: 2023-06-10&quot; : tile_layer_f89e6cc4f9af440816578f9b0368d76f,
                    &quot;AoI&quot; : geo_json_d1bcd93f006329f4f6afdaf8c4050da4,
                },
            };
            let layer_control_945c10320594d589a1d8f50cb9260014 = L.control.layers(
                layer_control_945c10320594d589a1d8f50cb9260014_layers.base_layers,
                layer_control_945c10320594d589a1d8f50cb9260014_layers.overlays,
                {&quot;autoZIndex&quot;: true, &quot;collapsed&quot;: false, &quot;position&quot;: &quot;topright&quot;}
            ).addTo(map_a76ce8d44fd50c73c76517c15b1593e0);

        
&lt;/script&gt;
&lt;/html&gt;" width="100%" height="600"style="border:none !important;" "allowfullscreen" "webkitallowfullscreen" "mozallowfullscreen"></iframe></div></div>
</div>
<p>By looking at the map with the images available we select the pre and post event images from Sentinel-2</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">date_pre</span> <span class="o">=</span> <span class="s2">&quot;2023-06-03&quot;</span>
<span class="n">pre_flood</span> <span class="o">=</span> <span class="n">flood_images_gee</span><span class="p">[</span><span class="n">flood_images_gee</span><span class="o">.</span><span class="n">solarday</span> <span class="o">==</span> <span class="n">date_pre</span><span class="p">]</span>

<span class="n">date_post</span> <span class="o">=</span> <span class="s2">&quot;2023-06-08&quot;</span>
<span class="n">post_flood</span> <span class="o">=</span> <span class="n">flood_images_gee</span><span class="p">[</span><span class="n">flood_images_gee</span><span class="o">.</span><span class="n">solarday</span> <span class="o">==</span> <span class="n">date_post</span><span class="p">]</span>
<span class="n">post_flood</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>geometry</th>
      <th>cloudcoverpercentage</th>
      <th>gee_id</th>
      <th>proj</th>
      <th>system:time_start</th>
      <th>collection_name</th>
      <th>utcdatetime</th>
      <th>overlappercentage</th>
      <th>solardatetime</th>
      <th>solarday</th>
      <th>localdatetime</th>
      <th>satellite</th>
      <th>localdatetime_str</th>
    </tr>
    <tr>
      <th>title</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>S2A_MSIL1C_20230608T084601_N0509_R107_T36TVS_20230608T104959</th>
      <td>POLYGON ((31.70898 45.95835, 31.70900 45.95835...</td>
      <td>91.090149</td>
      <td>20230608T084601_20230608T084938_T36TVS</td>
      <td>{'type': 'Projection', 'crs': 'EPSG:32636', 't...</td>
      <td>1686214645530</td>
      <td>COPERNICUS/S2_HARMONIZED</td>
      <td>2023-06-08 08:57:25.530000+00:00</td>
      <td>83.282631</td>
      <td>2023-06-08 11:07:04.427835+00:00</td>
      <td>2023-06-08</td>
      <td>2023-06-08 08:57:25.530000+00:00</td>
      <td>S2A</td>
      <td>2023-06-08 08:57:25</td>
    </tr>
    <tr>
      <th>S2A_MSIL1C_20230608T084601_N0509_R107_T36TWS_20230608T104959</th>
      <td>POLYGON ((34.44238 46.94462, 34.44228 46.94471...</td>
      <td>99.989920</td>
      <td>20230608T084601_20230608T084938_T36TWS</td>
      <td>{'type': 'Projection', 'crs': 'EPSG:32636', 't...</td>
      <td>1686214640951</td>
      <td>COPERNICUS/S2_HARMONIZED</td>
      <td>2023-06-08 08:57:20.951000+00:00</td>
      <td>28.918853</td>
      <td>2023-06-08 11:11:50.363462+00:00</td>
      <td>2023-06-08</td>
      <td>2023-06-08 08:57:20.951000+00:00</td>
      <td>S2A</td>
      <td>2023-06-08 08:57:20</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="step-3-read-the-data">
<h2>Step 3: Read the data<a class="headerlink" href="#step-3-read-the-data" title="Permalink to this heading">#</a></h2>
<p>There are Sentinel-2 cloud free images on 2023-06-03 and 2023-06-05 but only the first one covers the entire AoI. For the postflood data we will use 2023-06-08, which is partially cloudy but allows to see some flood extent. We will read and mosaic the tiles T36TVS and T36TWS using <strong>georeader</strong>.
The advantage of this workflow over Google Earth Engine (GEE) is that the images are read directly from the Sentinel-2 public bucket into the jupyter notebook. Also, there is no size limit in the download, which may cause GEE tasks to fail sometimes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="n">dir_cache</span> <span class="o">=</span> <span class="s2">&quot;cache_s2&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_cache</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">mosaic_s2</span><span class="p">(</span><span class="n">products</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">channels</span><span class="p">):</span>
    <span class="n">products_read</span> <span class="o">=</span> <span class="n">products</span><span class="o">.</span><span class="n">index</span>
    <span class="n">s2objs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">products_read</span><span class="p">:</span>
        <span class="n">s2_safe_folder</span> <span class="o">=</span> <span class="n">S2_SAFE_reader</span><span class="o">.</span><span class="n">s2_public_bucket_path</span><span class="p">(</span><span class="n">product</span><span class="o">+</span><span class="s2">&quot;.SAFE&quot;</span><span class="p">,</span> <span class="n">check_exists</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">s2obj</span> <span class="o">=</span> <span class="n">S2_SAFE_reader</span><span class="o">.</span><span class="n">s2loader</span><span class="p">(</span><span class="n">s2_safe_folder</span><span class="p">,</span> <span class="n">out_res</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="n">channels</span><span class="p">)</span>
        <span class="n">s2obj</span> <span class="o">=</span> <span class="n">s2obj</span><span class="o">.</span><span class="n">cache_product_to_local_dir</span><span class="p">(</span><span class="n">dir_cache</span><span class="p">)</span>
        <span class="n">s2objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s2obj</span><span class="p">)</span>
    
    <span class="n">polygon_read_dst_crs</span> <span class="o">=</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">polygon_to_crs</span><span class="p">(</span><span class="n">polygon</span><span class="p">,</span> 
                                                       <span class="n">crs_polygon</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="n">s2objs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
    
    <span class="n">data_memory</span> <span class="o">=</span> <span class="n">mosaic</span><span class="o">.</span><span class="n">spatial_mosaic</span><span class="p">(</span><span class="n">s2objs</span><span class="p">,</span> <span class="n">polygon</span><span class="o">=</span><span class="n">polygon_read_dst_crs</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span> <span class="n">s2objs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">data_memory</span>

<span class="n">channels</span> <span class="o">=</span> <span class="n">S2_SAFE_reader</span><span class="o">.</span><span class="n">BANDS_S2_L1C</span>
<span class="n">tiff_pre</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date_pre</span><span class="si">}</span><span class="s2">.tif&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tiff_pre</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading files </span><span class="si">{</span><span class="n">tiff_pre</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">pre_flood_memory</span> <span class="o">=</span> <span class="n">mosaic_s2</span><span class="p">(</span><span class="n">pre_flood</span><span class="p">,</span> <span class="n">aoi</span><span class="p">,</span><span class="n">channels</span><span class="p">)</span>
    <span class="n">save_cog</span><span class="p">(</span><span class="n">pre_flood_memory</span><span class="p">,</span> <span class="n">tiff_pre</span><span class="p">,</span> <span class="n">descriptions</span><span class="o">=</span><span class="n">S2_SAFE_reader</span><span class="o">.</span><span class="n">BANDS_S2_L1C</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading file </span><span class="si">{</span><span class="n">tiff_pre</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">pre_flood</span> <span class="o">=</span> <span class="n">RasterioReader</span><span class="p">(</span><span class="n">tiff_pre</span><span class="p">)</span>
    <span class="n">channels</span> <span class="o">=</span> <span class="n">pre_flood</span><span class="o">.</span><span class="n">descriptions</span>
    <span class="n">pre_flood</span> <span class="o">=</span> <span class="n">pre_flood</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="n">pre_flood_memory</span> <span class="o">=</span> <span class="n">pre_flood</span><span class="o">.</span><span class="n">values</span>

<span class="n">tiff_post</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date_post</span><span class="si">}</span><span class="s2">.tif&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tiff_post</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading file </span><span class="si">{</span><span class="n">tiff_post</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">post_flood_memory</span> <span class="o">=</span> <span class="n">mosaic_s2</span><span class="p">(</span><span class="n">post_flood</span><span class="p">,</span> <span class="n">aoi</span><span class="p">,</span><span class="n">channels</span><span class="p">)</span>
    <span class="n">save_cog</span><span class="p">(</span><span class="n">post_flood_memory</span><span class="p">,</span> <span class="n">tiff_post</span><span class="p">,</span> <span class="n">descriptions</span><span class="o">=</span><span class="n">S2_SAFE_reader</span><span class="o">.</span><span class="n">BANDS_S2_L1C</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading file </span><span class="si">{</span><span class="n">tiff_post</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">post_flood</span> <span class="o">=</span> <span class="n">RasterioReader</span><span class="p">(</span><span class="n">tiff_post</span><span class="p">)</span>
    <span class="n">channels</span> <span class="o">=</span> <span class="n">post_flood</span><span class="o">.</span><span class="n">descriptions</span>
    <span class="n">post_flood</span> <span class="o">=</span> <span class="n">post_flood</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="n">post_flood_memory</span> <span class="o">=</span> <span class="n">post_flood</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reading file 2023-06-03.tif
Reading file 2023-06-08.tif
CPU times: user 5min 10s, sys: 12.2 s, total: 5min 22s
Wall time: 5min 24s
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-3-load-the-model">
<h2>Step 3: Load the model<a class="headerlink" href="#step-3-load-the-model" title="Permalink to this heading">#</a></h2>
<p>For this we will use an Ml4floods multioutput binary model trained on the WorldFloods data set. See the <a class="reference external" href="https://www.nature.com/articles/s41598-023-47595-7">paper</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">huggingface_hub</span> <span class="kn">import</span> <span class="n">hf_hub_download</span>
<span class="c1"># os.makedirs(&quot;models/WF2_unetv2_bgriswirs&quot;, exist_ok=True)</span>
<span class="n">experiment_name</span> <span class="o">=</span> <span class="s2">&quot;WF2_unetv2_bgriswirs&quot;</span>
<span class="n">subfolder_local</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;models/</span><span class="si">{</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">config_file</span> <span class="o">=</span> <span class="n">hf_hub_download</span><span class="p">(</span><span class="n">repo_id</span><span class="o">=</span><span class="s2">&quot;isp-uv-es/ml4floods&quot;</span><span class="p">,</span><span class="n">subfolder</span><span class="o">=</span><span class="n">subfolder_local</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;config.json&quot;</span><span class="p">,</span>
                              <span class="n">local_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">local_dir_use_symlinks</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">model_file</span> <span class="o">=</span> <span class="n">hf_hub_download</span><span class="p">(</span><span class="n">repo_id</span><span class="o">=</span><span class="s2">&quot;isp-uv-es/ml4floods&quot;</span><span class="p">,</span><span class="n">subfolder</span><span class="o">=</span><span class="n">subfolder_local</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;model.pt&quot;</span><span class="p">,</span>
                              <span class="n">local_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">local_dir_use_symlinks</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><script type="application/vnd.jupyter.widget-view+json">{"model_id": "502676cf2ff84dac90f3e4f6d101fa57", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "6bcdfbc1aab640a5833fc771a6d99b76", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="n">inference_function</span><span class="p">,</span> <span class="n">config</span> <span class="o">=</span> <span class="n">load_inference_function</span><span class="p">(</span><span class="n">subfolder_local</span><span class="p">,</span> <span class="n">device_name</span> <span class="o">=</span> <span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">max_tile_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
                                                     <span class="n">th_water</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">th_brightness</span><span class="o">=</span><span class="mi">3500</span><span class="p">,</span> <span class="n">distinguish_flood_traces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">channel_configuration</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;data_params&#39;</span><span class="p">][</span><span class="s1">&#39;channel_configuration&#39;</span><span class="p">]</span>
<span class="n">channels</span>  <span class="o">=</span> <span class="n">get_channel_configuration_bands</span><span class="p">(</span><span class="n">channel_configuration</span><span class="p">,</span> <span class="n">collection_name</span><span class="o">=</span><span class="s1">&#39;S2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loaded model weights: models/WF2_unetv2_bgriswirs/model.pt
Getting model inference function
CPU times: user 71.6 ms, sys: 18.8 ms, total: 90.4 ms
Wall time: 73.2 ms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">,</span> <span class="n">channels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="p">):</span>
    <span class="n">input_tensor</span> <span class="o">=</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">input_tensor</span> <span class="o">=</span> <span class="n">input_tensor</span><span class="p">[</span><span class="n">channels</span><span class="p">]</span>
    <span class="n">torch_inputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">inference_function</span><span class="p">(</span><span class="n">torch_inputs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
</section>
<section id="step-4-run-inference">
<h2>Step 4: Run inference<a class="headerlink" href="#step-4-run-inference" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="n">postflood_pred</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date_post</span><span class="si">}</span><span class="s2">_pred.tif&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">postflood_pred</span><span class="p">):</span>
    <span class="n">prediction_postflood</span><span class="p">,</span> <span class="n">prediction_postflood_cont</span>  <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">post_flood_memory</span><span class="p">)</span>
    <span class="n">prediction_postflood_raster</span> <span class="o">=</span> <span class="n">GeoTensor</span><span class="p">(</span><span class="n">prediction_postflood</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">transform</span><span class="o">=</span><span class="n">post_flood</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span>
                                            <span class="n">fill_value_default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">post_flood</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
    <span class="n">save_cog</span><span class="p">(</span><span class="n">prediction_postflood_raster</span><span class="p">,</span> <span class="n">postflood_pred</span><span class="p">,</span> <span class="n">descriptions</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pred&quot;</span><span class="p">],</span> 
             <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;0&quot;</span><span class="p">:</span><span class="s2">&quot;invalid&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="s2">&quot;land&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span><span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">:</span><span class="s2">&quot;cloud&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">:</span><span class="s2">&quot;flood_trace&quot;</span><span class="p">})</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">prediction_postflood_raster</span> <span class="o">=</span> <span class="n">RasterioReader</span><span class="p">(</span><span class="n">postflood_pred</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

<span class="n">preflood_pred</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date_pre</span><span class="si">}</span><span class="s2">_pred.tif&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">preflood_pred</span><span class="p">):</span>
    <span class="n">prediction_preflood</span><span class="p">,</span> <span class="n">prediction_preflood_cont</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">pre_flood_memory</span><span class="p">)</span>
    <span class="c1"># Remove flood traces from pre-flood</span>
    <span class="n">prediction_preflood</span><span class="p">[</span><span class="n">prediction_preflood</span><span class="o">==</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="n">prediction_preflood_raster</span> <span class="o">=</span> <span class="n">GeoTensor</span><span class="p">(</span><span class="n">prediction_preflood</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">transform</span><span class="o">=</span><span class="n">pre_flood</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span>
                                           <span class="n">fill_value_default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">pre_flood</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
    
    <span class="n">save_cog</span><span class="p">(</span><span class="n">prediction_preflood_raster</span><span class="p">,</span> <span class="n">preflood_pred</span><span class="p">,</span> <span class="n">descriptions</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pred&quot;</span><span class="p">],</span> 
             <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;0&quot;</span><span class="p">:</span><span class="s2">&quot;invalid&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="s2">&quot;land&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span><span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">:</span><span class="s2">&quot;cloud&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">:</span><span class="s2">&quot;flood_trace&quot;</span><span class="p">})</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">prediction_preflood_raster</span> <span class="o">=</span> <span class="n">RasterioReader</span><span class="p">(</span><span class="n">preflood_pred</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 300 ms, sys: 64 ms, total: 364 ms
Wall time: 365 ms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">COLORS_PRED</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c1"># 0: invalid</span>
                       <span class="p">[</span><span class="mi">139</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c1"># 1: land</span>
                       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">240</span><span class="p">],</span> <span class="c1"># 2: water</span>
                       <span class="p">[</span><span class="mi">220</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">220</span><span class="p">],</span> <span class="c1"># 3: cloud</span>
                       <span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">92</span><span class="p">]],</span> <span class="c1"># 5: flood_trace</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
</section>
<section id="step-5-plot-the-results">
<h2>Step 5: Plot the results<a class="headerlink" href="#step-5-plot-the-results" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="n">plot_utils</span><span class="o">.</span><span class="n">plot_swirnirred_image</span><span class="p">(</span><span class="n">pre_flood_memory</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">transform</span> <span class="o">=</span> <span class="n">pre_flood</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">add_scalebar</span> <span class="o">=</span> <span class="kc">True</span> <span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sentinel-2 </span><span class="si">{</span><span class="n">date_pre</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">plot_utils</span><span class="o">.</span><span class="n">plot_swirnirred_image</span><span class="p">(</span><span class="n">post_flood_memory</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">transform</span> <span class="o">=</span> <span class="n">post_flood</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">add_scalebar</span> <span class="o">=</span> <span class="kc">True</span> <span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sentinel-2 </span><span class="si">{</span><span class="n">date_post</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">plot</span><span class="o">.</span><span class="n">plot_segmentation_mask</span><span class="p">(</span><span class="n">prediction_preflood_raster</span><span class="p">,</span> <span class="n">COLORS_PRED</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                            <span class="n">interpretation_array</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;invalids&quot;</span><span class="p">,</span> <span class="s2">&quot;land&quot;</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="s2">&quot;cloud&quot;</span><span class="p">,</span> <span class="s2">&quot;flood_trace&quot;</span><span class="p">])</span>


<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date_pre</span><span class="si">}</span><span class="s2"> floodmap&quot;</span><span class="p">)</span>

<span class="n">plot</span><span class="o">.</span><span class="n">plot_segmentation_mask</span><span class="p">(</span><span class="n">prediction_postflood_raster</span><span class="p">,</span> <span class="n">COLORS_PRED</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">interpretation_array</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;invalids&quot;</span><span class="p">,</span> <span class="s2">&quot;land&quot;</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="s2">&quot;cloud&quot;</span><span class="p">,</span> <span class="s2">&quot;flood_trace&quot;</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date_post</span><span class="si">}</span><span class="s2"> floodmap&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;2023-06-08 floodmap&#39;)
</pre></div>
</div>
<img alt="../../_images/45a21f2f9cc4e53e0ed4442404ccfeb1883287f0767e6d1a5a261c0d6cb88b6a.png" src="../../_images/45a21f2f9cc4e53e0ed4442404ccfeb1883287f0767e6d1a5a261c0d6cb88b6a.png" />
</div>
</div>
</section>
<section id="step-5-vectorize-predictions-into-prepost-flood-products">
<h2>Step 5: Vectorize predictions into prepost flood products<a class="headerlink" href="#step-5-vectorize-predictions-into-prepost-flood-products" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prediction_preflood_raster</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(5700, 8800)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preflood_shape</span> <span class="o">=</span> <span class="n">vectorize_outputv1</span><span class="p">(</span><span class="n">prediction_preflood_raster</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
                                    <span class="n">prediction_preflood_raster</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> 
                                    <span class="n">prediction_preflood_raster</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
<span class="n">postflood_shape</span> <span class="o">=</span> <span class="n">vectorize_outputv1</span><span class="p">(</span><span class="n">prediction_postflood_raster</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
                                     <span class="n">prediction_postflood_raster</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> 
                                     <span class="n">prediction_postflood_raster</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
<span class="n">postflood_shape</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2893, 3)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plot_utils</span><span class="o">.</span><span class="n">plot_floodmap</span><span class="p">(</span><span class="n">preflood_shape</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date_pre</span><span class="si">}</span><span class="s2"> floodmap&quot;</span><span class="p">)</span>
<span class="n">plot_utils</span><span class="o">.</span><span class="n">plot_floodmap</span><span class="p">(</span><span class="n">postflood_shape</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date_post</span><span class="si">}</span><span class="s2"> floodmap&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;2023-06-08 floodmap&#39;)
</pre></div>
</div>
<img alt="../../_images/2131ba21594166ac195b28aaddae2312486971b326a499d5b882c4e224035ab2.png" src="../../_images/2131ba21594166ac195b28aaddae2312486971b326a499d5b882c4e224035ab2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prepost_shape</span> <span class="o">=</span> <span class="n">postprocess</span><span class="o">.</span><span class="n">compute_pre_post_flood_water</span><span class="p">(</span><span class="n">postflood_shape</span><span class="p">,</span> <span class="n">preflood_shape</span><span class="p">)</span>
<span class="n">plot_utils</span><span class="o">.</span><span class="n">plot_floodmap</span><span class="p">(</span><span class="n">prepost_shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/gonzalo/mambaforge/envs/ml4floods2/lib/python3.10/site-packages/geopandas/geoseries.py:645: FutureWarning: the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
  result = super().apply(func, convert_dtype=convert_dtype, args=args, **kwargs)
/home/gonzalo/mambaforge/envs/ml4floods2/lib/python3.10/site-packages/geopandas/geoseries.py:645: FutureWarning: the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
  result = super().apply(func, convert_dtype=convert_dtype, args=args, **kwargs)
/home/gonzalo/mambaforge/envs/ml4floods2/lib/python3.10/site-packages/geopandas/geoseries.py:645: FutureWarning: the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
  result = super().apply(func, convert_dtype=convert_dtype, args=args, **kwargs)
/home/gonzalo/mambaforge/envs/ml4floods2/lib/python3.10/site-packages/geopandas/geoseries.py:645: FutureWarning: the convert_dtype parameter is deprecated and will be removed in a future version.  Do ``ser.astype(object).apply()`` instead if you want ``convert_dtype=False``.
  result = super().apply(func, convert_dtype=convert_dtype, args=args, **kwargs)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/fa83105c1e11473cccb1bfecd5ff28f4360ad091f8944cf7b7731e100f8f0138.png" src="../../_images/fa83105c1e11473cccb1bfecd5ff28f4360ad091f8944cf7b7731e100f8f0138.png" />
</div>
</div>
<section id="run-inference-in-landsat-8-9">
<h3>Run inference in Landsat 8/9<a class="headerlink" href="#run-inference-in-landsat-8-9" title="Permalink to this heading">#</a></h3>
<p>There is a cloud free Landsat 9 image from the 2023-06-09. In the following cells we downloaded the image from Google Earth Engine, we run inference on it and show how to aggregate several post-flood maps over time of images acquired by different sensors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="n">bands_l89</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;B2&quot;</span><span class="p">,</span> <span class="s2">&quot;B3&quot;</span><span class="p">,</span> <span class="s2">&quot;B4&quot;</span><span class="p">,</span> <span class="s2">&quot;B5&quot;</span><span class="p">,</span> <span class="s2">&quot;B6&quot;</span><span class="p">,</span> <span class="s2">&quot;B7&quot;</span><span class="p">]</span>
<span class="n">postfloodsl9</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">l89_image_info</span> <span class="ow">in</span> <span class="n">flood_images_gee</span><span class="p">[</span><span class="n">flood_images_gee</span><span class="o">.</span><span class="n">solarday</span> <span class="o">==</span> <span class="s2">&quot;2023-06-09&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
    <span class="n">asset_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l89_image_info</span><span class="o">.</span><span class="n">collection_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">l89_image_info</span><span class="o">.</span><span class="n">gee_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">geom</span> <span class="o">=</span> <span class="n">l89_image_info</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">aoi</span><span class="p">)</span>
    <span class="n">postfloodsl9</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ee_image</span><span class="o">.</span><span class="n">export_image_getpixels</span><span class="p">(</span><span class="n">asset_id</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="n">l89_image_info</span><span class="o">.</span><span class="n">proj</span><span class="p">,</span> 
                                                        <span class="n">bands_gee</span><span class="o">=</span><span class="n">bands_l89</span><span class="p">))</span>

<span class="n">dst_crs</span> <span class="o">=</span> <span class="n">postfloodsl9</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">crs</span>
<span class="n">aoi_dst_crs</span> <span class="o">=</span> <span class="n">window_utils</span><span class="o">.</span><span class="n">polygon_to_crs</span><span class="p">(</span><span class="n">aoi</span><span class="p">,</span> <span class="n">crs_polygon</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="n">dst_crs</span><span class="p">)</span>
<span class="n">postfloodl9</span> <span class="o">=</span> <span class="n">mosaic</span><span class="o">.</span><span class="n">spatial_mosaic</span><span class="p">(</span><span class="n">postfloodsl9</span><span class="p">,</span> <span class="n">polygon</span><span class="o">=</span><span class="n">aoi_dst_crs</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="n">dst_crs</span><span class="p">)</span>
<span class="n">postfloodl9</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">postfloodl9</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">postfloodl9</span><span class="o">.</span><span class="n">fill_value_default</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">postfloodl9</span><span class="o">.</span><span class="n">fill_value_default</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">post_flood_l9_data</span> <span class="o">=</span> <span class="n">postfloodl9</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="mi">10000</span>
<span class="n">postfloodl9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning 1: TIFFReadDirectory:Sum of Photometric type-related color channels and ExtraSamples doesn&#39;t match SamplesPerPixel. Defining non-color channels as ExtraSamples.
Warning 1: TIFFReadDirectory:Sum of Photometric type-related color channels and ExtraSamples doesn&#39;t match SamplesPerPixel. Defining non-color channels as ExtraSamples.
Warning 1: TIFFReadDirectory:Sum of Photometric type-related color channels and ExtraSamples doesn&#39;t match SamplesPerPixel. Defining non-color channels as ExtraSamples.
Warning 1: TIFFReadDirectory:Sum of Photometric type-related color channels and ExtraSamples doesn&#39;t match SamplesPerPixel. Defining non-color channels as ExtraSamples.
Warning 1: TIFFReadDirectory:Sum of Photometric type-related color channels and ExtraSamples doesn&#39;t match SamplesPerPixel. Defining non-color channels as ExtraSamples.
Warning 1: TIFFReadDirectory:Sum of Photometric type-related color channels and ExtraSamples doesn&#39;t match SamplesPerPixel. Defining non-color channels as ExtraSamples.
Warning 1: TIFFReadDirectory:Sum of Photometric type-related color channels and ExtraSamples doesn&#39;t match SamplesPerPixel. Defining non-color channels as ExtraSamples.
Warning 1: TIFFReadDirectory:Sum of Photometric type-related color channels and ExtraSamples doesn&#39;t match SamplesPerPixel. Defining non-color channels as ExtraSamples.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 2.35 s, sys: 537 ms, total: 2.89 s
Wall time: 1min 18s
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 
         Transform: | 30.00, 0.00, 443205.00|
| 0.00,-30.00, 5196705.00|
| 0.00, 0.00, 1.00|
         Shape: (6, 1900, 2933)
         Resolution: (30.0, 30.0)
         Bounds: (443205.0, 5139705.0, 531195.0, 5196705.0)
         CRS: EPSG:32636
         fill_value_default: 0
        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">save_cog</span><span class="p">(</span><span class="n">postfloodl9</span><span class="p">,</span> <span class="s2">&quot;2023-06-09.tif&quot;</span><span class="p">,</span> <span class="n">descriptions</span><span class="o">=</span><span class="n">bands_l89</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">postflood_pred</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;2023-06-09_pred.tif&quot;</span>

<span class="n">prediction_postflood</span><span class="p">,</span> <span class="n">prediction_postflood_cont</span>  <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">post_flood_l9_data</span><span class="p">,</span> <span class="n">channels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">prediction_postflood_raster</span> <span class="o">=</span> <span class="n">GeoTensor</span><span class="p">(</span><span class="n">prediction_postflood</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">transform</span><span class="o">=</span><span class="n">postfloodl9</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span>
                                        <span class="n">fill_value_default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">postfloodl9</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>

<span class="n">save_cog</span><span class="p">(</span><span class="n">prediction_postflood_raster</span><span class="p">,</span> <span class="n">postflood_pred</span><span class="p">,</span> <span class="n">descriptions</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pred&quot;</span><span class="p">],</span> 
         <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;0&quot;</span><span class="p">:</span><span class="s2">&quot;invalid&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="s2">&quot;land&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span><span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">:</span><span class="s2">&quot;cloud&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">:</span><span class="s2">&quot;flood_trace&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="n">show</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">post_flood_l9_data</span><span class="p">[[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],:,:]</span> <span class="o">/</span> <span class="mi">3500</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
     <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">transform</span> <span class="o">=</span> <span class="n">postfloodl9</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>


<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Landsat 9 2023-06-09&quot;</span><span class="p">)</span>


<span class="n">plot</span><span class="o">.</span><span class="n">plot_segmentation_mask</span><span class="p">(</span><span class="n">prediction_postflood_raster</span><span class="p">,</span> <span class="n">COLORS_PRED</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">interpretation_array</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;invalids&quot;</span><span class="p">,</span> <span class="s2">&quot;land&quot;</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="s2">&quot;cloud&quot;</span><span class="p">,</span> <span class="s2">&quot;flood_trace&quot;</span><span class="p">],</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Floodmap 2023-06-09&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><img alt="../../_images/fbffab9f25c2cce02ab566edaedf0cf2145181909514c79570c14f4d51031625.png" src="../../_images/fbffab9f25c2cce02ab566edaedf0cf2145181909514c79570c14f4d51031625.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">post_flood_shape_l9</span> <span class="o">=</span> <span class="n">vectorize_outputv1</span><span class="p">(</span><span class="n">prediction_postflood_raster</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
                                    <span class="n">prediction_postflood_raster</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> 
                                    <span class="n">prediction_postflood_raster</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
</section>
</section>
<section id="join-the-floodmaps-of-sentinel-2-and-landsat">
<h2>Join the floodmaps of Sentinel-2 and Landsat<a class="headerlink" href="#join-the-floodmaps-of-sentinel-2-and-landsat" title="Permalink to this heading">#</a></h2>
<p>Here we join the floodmaps of the two satellites using the <code class="docutils literal notranslate"><span class="pre">max</span></code> mode.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="n">area_imaged</span> <span class="o">=</span> <span class="n">post_flood_shape_l9</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">post_flood_shape_l9</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;area_imaged&#39;</span><span class="p">]</span>

<span class="c1"># Remove flood traces for the max extent join</span>
<span class="n">post_flood_shape_l9</span> <span class="o">=</span> <span class="n">post_flood_shape_l9</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">post_flood_shape_l9</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">!=</span><span class="s1">&#39;flood_trace&#39;</span><span class="p">]</span>
<span class="n">post_flood_shape</span> <span class="o">=</span> <span class="n">postflood_shape</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">postflood_shape</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">!=</span><span class="s1">&#39;flood_trace&#39;</span><span class="p">]</span>

<span class="n">postflood_mosaic</span> <span class="o">=</span> <span class="n">postprocess</span><span class="o">.</span><span class="n">mosaic_floodmaps</span><span class="p">([</span><span class="n">post_flood_shape</span><span class="p">,</span> <span class="n">post_flood_shape_l9</span><span class="p">],</span> <span class="n">area_imaged</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> 
                                                <span class="n">classes_water</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;water&#39;</span><span class="p">,</span><span class="s1">&#39;flood_trace&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">plot_utils</span><span class="o">.</span><span class="n">plot_floodmap</span><span class="p">(</span><span class="n">post_flood_shape</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date_post</span><span class="si">}</span><span class="s2"> Sentinel-2 floodmap&quot;</span><span class="p">)</span>
<span class="n">plot_utils</span><span class="o">.</span><span class="n">plot_floodmap</span><span class="p">(</span><span class="n">post_flood_shape_l9</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;2023-06-09 Landsat 9 floodmap&quot;</span><span class="p">)</span>
<span class="n">plot_utils</span><span class="o">.</span><span class="n">plot_floodmap</span><span class="p">(</span><span class="n">postflood_mosaic</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mosaic floodmap&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Mosaic floodmap&#39;)
</pre></div>
</div>
<img alt="../../_images/b0681ce93e2332760a1df9bc972814467a017189bd979c7c43b2ef24e1032219.png" src="../../_images/b0681ce93e2332760a1df9bc972814467a017189bd979c7c43b2ef24e1032219.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prepost_shape_final</span> <span class="o">=</span> <span class="n">postprocess</span><span class="o">.</span><span class="n">compute_pre_post_flood_water</span><span class="p">(</span><span class="n">postflood_mosaic</span><span class="p">,</span> <span class="n">preflood_shape</span><span class="p">)</span>
<span class="n">prepost_shape_final</span> <span class="o">=</span> <span class="n">prepost_shape_final</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prepost_shape_final</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;water-pre-flood&#39;</span><span class="p">,</span><span class="s1">&#39;water-post-flood&#39;</span><span class="p">,</span><span class="s1">&#39;area_imaged&#39;</span><span class="p">])]</span>
<span class="n">plot_utils</span><span class="o">.</span><span class="n">plot_floodmap</span><span class="p">(</span><span class="n">prepost_shape_final</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }
                    
                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }
                
                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }
                    
                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            </div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/c0bb535b771167c4111bb4b15a73aaa43da210b791607bb112ebeb2a56c48b63.png" src="../../_images/c0bb535b771167c4111bb4b15a73aaa43da210b791607bb112ebeb2a56c48b63.png" />
</div>
</div>
</section>
<section id="licence">
<h2>Licence<a class="headerlink" href="#licence" title="Permalink to this heading">#</a></h2>
<p>The ML4Floods package is published under a <a class="reference external" href="https://www.gnu.org/licenses/lgpl-3.0.en.html">GNU Lesser GPL v3 licence</a></p>
<p>The <em>WorldFloods</em> database and all pre-trained models are released under a <a class="reference external" href="https://creativecommons.org/licenses/by-nc/4.0/legalcode.txt">Creative Commons non-commercial licence</a>. For using the models in comercial pipelines written consent by the authors must be provided.</p>
<p>If you find this work useful please cite:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@article</span><span class="p">{</span><span class="n">portales</span><span class="o">-</span><span class="n">julia_global_2023</span><span class="p">,</span>
	<span class="n">title</span> <span class="o">=</span> <span class="p">{</span><span class="n">Global</span> <span class="n">flood</span> <span class="n">extent</span> <span class="n">segmentation</span> <span class="ow">in</span> <span class="n">optical</span> <span class="n">satellite</span> <span class="n">images</span><span class="p">},</span>
	<span class="n">volume</span> <span class="o">=</span> <span class="p">{</span><span class="mi">13</span><span class="p">},</span>
	<span class="n">issn</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2045</span><span class="o">-</span><span class="mi">2322</span><span class="p">},</span>
	<span class="n">doi</span> <span class="o">=</span> <span class="p">{</span><span class="mf">10.1038</span><span class="o">/</span><span class="n">s41598</span><span class="o">-</span><span class="mi">023</span><span class="o">-</span><span class="mi">47595</span><span class="o">-</span><span class="mi">7</span><span class="p">},</span>
	<span class="n">number</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">},</span>
	<span class="n">urldate</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2023</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">30</span><span class="p">},</span>
	<span class="n">journal</span> <span class="o">=</span> <span class="p">{</span><span class="n">Scientific</span> <span class="n">Reports</span><span class="p">},</span>
	<span class="n">author</span> <span class="o">=</span> <span class="p">{</span><span class="n">Portalés</span><span class="o">-</span><span class="n">Julià</span><span class="p">,</span> <span class="n">Enrique</span> <span class="ow">and</span> <span class="n">Mateo</span><span class="o">-</span><span class="n">García</span><span class="p">,</span> <span class="n">Gonzalo</span> <span class="ow">and</span> <span class="n">Purcell</span><span class="p">,</span> <span class="n">Cormac</span> <span class="ow">and</span> <span class="n">Gómez</span><span class="o">-</span><span class="n">Chova</span><span class="p">,</span> <span class="n">Luis</span><span class="p">},</span>
	<span class="n">month</span> <span class="o">=</span> <span class="n">nov</span><span class="p">,</span>
	<span class="n">year</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2023</span><span class="p">},</span>
	<span class="n">pages</span> <span class="o">=</span> <span class="p">{</span><span class="mi">20316</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "ml4floods"
        },
        kernelOptions: {
            name: "ml4floods",
            path: "./content/ml4ops"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ml4floods'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../config.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction</p>
      </div>
    </a>
    <a class="right-next"
       href="HOWTO_Run_Inference_multioutput_binary.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Inference with clouds aware floods segmentation model</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-install-and-import-the-necessary-packages">Step 1: Install and import the necessary packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-define-query-parameters-area-of-interest-and-dates">Step 2: Define query parameters: area of interest and dates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-read-the-data">Step 3: Read the data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-load-the-model">Step 3: Load the model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-run-inference">Step 4: Run inference</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-plot-the-results">Step 5: Plot the results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-vectorize-predictions-into-prepost-flood-products">Step 5: Vectorize predictions into prepost flood products</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#run-inference-in-landsat-8-9">Run inference in Landsat 8/9</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#join-the-floodmaps-of-sentinel-2-and-landsat">Join the floodmaps of Sentinel-2 and Landsat</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#licence">Licence</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By <a href="http://spaceml.org/" target="_blank">spaceml.org</a>
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>